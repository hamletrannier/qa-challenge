"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getWindowPosition = exports.getElementFromPoint = exports.getIframePointRelativeToParentFrame = exports.getIframeClientCoordinates = exports.containsOffset = exports.getOffsetPosition = exports.getClientPosition = void 0;
const axis_values_1 = __importDefault(require("../../../../../../../shared/utils/values/axis-values"));
const boundary_values_1 = __importDefault(require("../../../../../../../shared/utils/values/boundary-values"));
const dom_utils_1 = require("./dom-utils");
const clientsManager = __importStar(require("../clients-manager"));
const style_utils_1 = require("./style-utils");
async function getClientPosition(node) {
    const boxModel = await style_utils_1.getBoxModel(node);
    return new axis_values_1.default(boxModel.border[0], boxModel.border[1]);
}
exports.getClientPosition = getClientPosition;
async function getOffsetPosition(node) {
    const dimensions = await style_utils_1.getClientDimensions(node);
    const { left, top } = await style_utils_1.getDocumentScroll(node);
    return { left: dimensions.left + left, top: dimensions.top + top };
}
exports.getOffsetPosition = getOffsetPosition;
async function containsOffset(node, offsetX, offsetY) {
    const dimensions = await style_utils_1.getClientDimensions(node);
    const properties = await style_utils_1.getProperties(node, 'scrollWidth', 'scrollHeight');
    const width = Math.max(Number(properties.scrollWidth), dimensions.width);
    const height = Math.max(Number(properties.scrollHeight), dimensions.height);
    const maxX = dimensions.scrollbar.right + dimensions.border.left + dimensions.border.right + width;
    const maxY = dimensions.scrollbar.bottom + dimensions.border.top + dimensions.border.bottom + height;
    return (typeof offsetX === 'undefined' || offsetX >= 0 && maxX >= offsetX) &&
        (typeof offsetY === 'undefined' || offsetY >= 0 && maxY >= offsetY);
}
exports.containsOffset = containsOffset;
async function getIframeClientCoordinates(node) {
    const dimensions = await style_utils_1.getClientDimensions(node);
    const [left, top, right, bottom] = [
        dimensions.left + dimensions.border.left + dimensions.paddings.left,
        dimensions.top + dimensions.border.top + dimensions.paddings.left,
        dimensions.right - dimensions.border.right - dimensions.paddings.right,
        dimensions.bottom - dimensions.border.bottom - dimensions.paddings.bottom,
    ];
    return new boundary_values_1.default(top, right, bottom, left);
}
exports.getIframeClientCoordinates = getIframeClientCoordinates;
async function getIframePointRelativeToParentFrame(iframePoint, context) {
    const iframe = await dom_utils_1.findIframeByWindow(context);
    if (!iframe)
        return null;
    const dimensions = await style_utils_1.getClientDimensions(iframe);
    const paddings = await style_utils_1.getElementPadding(iframe);
    const left = dimensions.left + dimensions.border.left + paddings.left + iframePoint.x;
    const top = dimensions.top + dimensions.border.top + paddings.top + iframePoint.y;
    return new axis_values_1.default(left, top);
}
exports.getIframePointRelativeToParentFrame = getIframePointRelativeToParentFrame;
async function getElementFromPoint(point) {
    const { DOM } = clientsManager.getClient();
    try {
        const { backendNodeId } = await DOM.getNodeForLocation({ x: point.x, y: point.y });
        return DOM.resolveNode({ backendNodeId });
    }
    catch (_a) {
        // NOTE: TODO: for some reason this methods throws error for correct `point` values
        // always throws error for negative values
    }
    return null;
}
exports.getElementFromPoint = getElementFromPoint;
async function getWindowPosition() {
    const { Runtime } = clientsManager.getClient();
    const args = {
        expression: `({
            x: window.screenLeft || window.screenX,
            y: window.screenTop || window.screenY
        })`,
        returnByValue: true,
    };
    const { result } = await Runtime.evaluate(args);
    return result.value;
}
exports.getWindowPosition = getWindowPosition;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb24tdXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvYnJvd3Nlci9wcm92aWRlci9idWlsdC1pbi9kZWRpY2F0ZWQvY2hyb21lL2NkcC1jbGllbnQvdXRpbHMvcG9zaXRpb24tdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLHVHQUFpSDtBQUNqSCwrR0FBOEc7QUFDOUcsMkNBQWlEO0FBQ2pELG1FQUFxRDtBQUdyRCwrQ0FNdUI7QUFFaEIsS0FBSyxVQUFVLGlCQUFpQixDQUFFLElBQWdCO0lBQ3JELE1BQU0sUUFBUSxHQUFHLE1BQU0seUJBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUV6QyxPQUFPLElBQUkscUJBQVUsQ0FBUyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMxRSxDQUFDO0FBSkQsOENBSUM7QUFFTSxLQUFLLFVBQVUsaUJBQWlCLENBQUUsSUFBZ0I7SUFDckQsTUFBTSxVQUFVLEdBQU0sTUFBTSxpQ0FBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0RCxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLE1BQU0sK0JBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFcEQsT0FBTyxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsSUFBSSxHQUFHLElBQUksRUFBRSxHQUFHLEVBQUUsVUFBVSxDQUFDLEdBQUcsR0FBRyxHQUFHLEVBQUUsQ0FBQztBQUN2RSxDQUFDO0FBTEQsOENBS0M7QUFFTSxLQUFLLFVBQVUsY0FBYyxDQUFFLElBQWdCLEVBQUUsT0FBZSxFQUFFLE9BQWU7SUFDcEYsTUFBTSxVQUFVLEdBQUcsTUFBTSxpQ0FBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuRCxNQUFNLFVBQVUs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QUVNLEtBQUssVUFBVSxtQkFBbUIsQ0FBRSxLQUE2QjtJQUNwRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsY0FBYyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBRTNDLElBQUk7UUFDQSxNQUFNLEVBQUUsYUFBYSxFQUFFLEdBQUcsTUFBTSxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFbkYsT0FBTyxHQUFHLENBQUMsV0FBVyxDQUFDLEVBQUUsYUFBYSxFQUFFLENBQUMsQ0FBQztLQUM3QztJQUNELFdBQU07UUFDRixtRkFBbUY7UUFDbkYsMENBQTBDO0tBQzdDO0lBRUQsT0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQztBQWRELGtEQWNDO0FBRU0sS0FBSyxVQUFVLGlCQUFpQjtJQUNuQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsY0FBYyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBRS9DLE1BQU0sSUFBSSxHQUFxQztRQUMzQyxVQUFVLEVBQUU7OztXQUdUO1FBQ0gsYUFBYSxFQUFFLElBQUk7S0FDdEIsQ0FBQztJQUVGLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxNQUFNLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFaEQsT0FBTyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ3hCLENBQUM7QUFkRCw4Q0FjQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm90b2NvbCBmcm9tICdkZXZ0b29scy1wcm90b2NvbC90eXBlcy9wcm90b2NvbCc7XG5pbXBvcnQgRXhlY3V0aW9uQ29udGV4dCBmcm9tICcuLi9leGVjdXRpb24tY29udGV4dCc7XG5pbXBvcnQgQXhpc1ZhbHVlcywgeyBBeGlzVmFsdWVzRGF0YSwgTGVmdFRvcFZhbHVlcyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NoYXJlZC91dGlscy92YWx1ZXMvYXhpcy12YWx1ZXMnO1xuaW1wb3J0IEJvdW5kYXJ5VmFsdWVzLCB7IEJvdW5kYXJ5VmFsdWVzRGF0YSB9IGZyb20gJy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NoYXJlZC91dGlscy92YWx1ZXMvYm91bmRhcnktdmFsdWVzJztcbmltcG9ydCB7IGZpbmRJZnJhbWVCeVdpbmRvdyB9IGZyb20gJy4vZG9tLXV0aWxzJztcbmltcG9ydCAqIGFzIGNsaWVudHNNYW5hZ2VyIGZyb20gJy4uL2NsaWVudHMtbWFuYWdlcic7XG5pbXBvcnQgeyBTZXJ2ZXJOb2RlIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5pbXBvcnQge1xuICAgIGdldEJveE1vZGVsLFxuICAgIGdldENsaWVudERpbWVuc2lvbnMsXG4gICAgZ2V0RG9jdW1lbnRTY3JvbGwsXG4gICAgZ2V0RWxlbWVudFBhZGRpbmcsXG4gICAgZ2V0UHJvcGVydGllcyxcbn0gZnJvbSAnLi9zdHlsZS11dGlscyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDbGllbnRQb3NpdGlvbiAobm9kZTogU2VydmVyTm9kZSk6IFByb21pc2U8QXhpc1ZhbHVlczxudW1iZXI+PiB7XG4gICAgY29uc3QgYm94TW9kZWwgPSBhd2FpdCBnZXRCb3hNb2RlbChub2RlKTtcblxuICAgIHJldHVybiBuZXcgQXhpc1ZhbHVlczxudW1iZXI+KGJveE1vZGVsLmJvcmRlclswXSwgYm94TW9kZWwuYm9yZGVyWzFdKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE9mZnNldFBvc2l0aW9uIChub2RlOiBTZXJ2ZXJOb2RlKTogUHJvbWlzZTxMZWZ0VG9wVmFsdWVzPG51bWJlcj4+IHtcbiAgICBjb25zdCBkaW1lbnNpb25zICAgID0gYXdhaXQgZ2V0Q2xpZW50RGltZW5zaW9ucyhub2RlKTtcbiAgICBjb25zdCB7IGxlZnQsIHRvcCB9ID0gYXdhaXQgZ2V0RG9jdW1lbnRTY3JvbGwobm9kZSk7XG5cbiAgICByZXR1cm4geyBsZWZ0OiBkaW1lbnNpb25zLmxlZnQgKyBsZWZ0LCB0b3A6IGRpbWVuc2lvbnMudG9wICsgdG9wIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb250YWluc09mZnNldCAobm9kZTogU2VydmVyTm9kZSwgb2Zmc2V0WDogbnVtYmVyLCBvZmZzZXRZOiBudW1iZXIpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBkaW1lbnNpb25zID0gYXdhaXQgZ2V0Q2xpZW50RGltZW5zaW9ucyhub2RlKTtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gYXdhaXQgZ2V0UHJvcGVydGllcyhub2RlLCAnc2Nyb2xsV2lkdGgnLCAnc2Nyb2xsSGVpZ2h0Jyk7XG5cbiAgICBjb25zdCB3aWR0aCAgPSBNYXRoLm1heChOdW1iZXIocHJvcGVydGllcy5zY3JvbGxXaWR0aCksIGRpbWVuc2lvbnMud2lkdGgpO1xuICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KE51bWJlcihwcm9wZXJ0aWVzLnNjcm9sbEhlaWdodCksIGRpbWVuc2lvbnMuaGVpZ2h0KTtcbiAgICBjb25zdCBtYXhYICAgPSBkaW1lbnNpb25zLnNjcm9sbGJhci5yaWdodCArIGRpbWVuc2lvbnMuYm9yZGVyLmxlZnQgKyBkaW1lbnNpb25zLmJvcmRlci5yaWdodCArIHdpZHRoO1xuICAgIGNvbnN0IG1heFkgICA9IGRpbWVuc2lvbnMuc2Nyb2xsYmFyLmJvdHRvbSArIGRpbWVuc2lvbnMuYm9yZGVyLnRvcCArIGRpbWVuc2lvbnMuYm9yZGVyLmJvdHRvbSArIGhlaWdodDtcblxuICAgIHJldHVybiAodHlwZW9mIG9mZnNldFggPT09ICd1bmRlZmluZWQnIHx8IG9mZnNldFggPj0gMCAmJiBtYXhYID49IG9mZnNldFgpICYmXG4gICAgICAgICh0eXBlb2Ygb2Zmc2V0WSA9PT0gJ3VuZGVmaW5lZCcgfHwgb2Zmc2V0WSA+PSAwICYmIG1heFkgPj0gb2Zmc2V0WSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRJZnJhbWVDbGllbnRDb29yZGluYXRlcyAobm9kZTogU2VydmVyTm9kZSk6IFByb21pc2U8Qm91bmRhcnlWYWx1ZXNEYXRhPiB7XG4gICAgY29uc3QgZGltZW5zaW9ucyA9IGF3YWl0IGdldENsaWVudERpbWVuc2lvbnMobm9kZSk7XG5cbiAgICBjb25zdCBbIGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSBdID0gW1xuICAgICAgICBkaW1lbnNpb25zLmxlZnQgKyBkaW1lbnNpb25zLmJvcmRlci5sZWZ0ICsgZGltZW5zaW9ucy5wYWRkaW5ncy5sZWZ0LFxuICAgICAgICBkaW1lbnNpb25zLnRvcCArIGRpbWVuc2lvbnMuYm9yZGVyLnRvcCArIGRpbWVuc2lvbnMucGFkZGluZ3MubGVmdCxcbiAgICAgICAgZGltZW5zaW9ucy5yaWdodCAtIGRpbWVuc2lvbnMuYm9yZGVyLnJpZ2h0IC0gZGltZW5zaW9ucy5wYWRkaW5ncy5yaWdodCxcbiAgICAgICAgZGltZW5zaW9ucy5ib3R0b20gLSBkaW1lbnNpb25zLmJvcmRlci5ib3R0b20gLSBkaW1lbnNpb25zLnBhZGRpbmdzLmJvdHRvbSxcbiAgICBdO1xuXG4gICAgcmV0dXJuIG5ldyBCb3VuZGFyeVZhbHVlcyh0b3AsIHJpZ2h0LCBib3R0b20sIGxlZnQpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SWZyYW1lUG9pbnRSZWxhdGl2ZVRvUGFyZW50RnJhbWUgKGlmcmFtZVBvaW50OiBBeGlzVmFsdWVzPG51bWJlcj4sIGNvbnRleHQ6IEV4ZWN1dGlvbkNvbnRleHQpOiBQcm9taXNlPEF4aXNWYWx1ZXM8bnVtYmVyPiB8IG51bGw+IHtcbiAgICBjb25zdCBpZnJhbWUgPSBhd2FpdCBmaW5kSWZyYW1lQnlXaW5kb3coY29udGV4dCk7XG5cbiAgICBpZiAoIWlmcmFtZSlcbiAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBkaW1lbnNpb25zID0gYXdhaXQgZ2V0Q2xpZW50RGltZW5zaW9ucyhpZnJhbWUpO1xuICAgIGNvbnN0IHBhZGRpbmdzICAgPSBhd2FpdCBnZXRFbGVtZW50UGFkZGluZyhpZnJhbWUpO1xuXG4gICAgY29uc3QgbGVmdCA9IGRpbWVuc2lvbnMubGVmdCArIGRpbWVuc2lvbnMuYm9yZGVyLmxlZnQgKyBwYWRkaW5ncy5sZWZ0ICsgaWZyYW1lUG9pbnQueDtcbiAgICBjb25zdCB0b3AgID0gZGltZW5zaW9ucy50b3AgKyBkaW1lbnNpb25zLmJvcmRlci50b3AgKyBwYWRkaW5ncy50b3AgKyBpZnJhbWVQb2ludC55O1xuXG4gICAgcmV0dXJuIG5ldyBBeGlzVmFsdWVzPG51bWJlcj4obGVmdCwgdG9wKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEVsZW1lbnRGcm9tUG9pbnQgKHBvaW50OiBBeGlzVmFsdWVzRGF0YTxudW1iZXI+KTogUHJvbWlzZTxQcm90b2NvbC5ET00uUmVzb2x2ZU5vZGVSZXNwb25zZSB8IG51bGw+IHtcbiAgICBjb25zdCB7IERPTSB9ID0gY2xpZW50c01hbmFnZXIuZ2V0Q2xpZW50KCk7XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGJhY2tlbmROb2RlSWQgfSA9IGF3YWl0IERPTS5nZXROb2RlRm9yTG9jYXRpb24oeyB4OiBwb2ludC54LCB5OiBwb2ludC55IH0pO1xuXG4gICAgICAgIHJldHVybiBET00ucmVzb2x2ZU5vZGUoeyBiYWNrZW5kTm9kZUlkIH0pO1xuICAgIH1cbiAgICBjYXRjaCB7XG4gICAgICAgIC8vIE5PVEU6IFRPRE86IGZvciBzb21lIHJlYXNvbiB0aGlzIG1ldGhvZHMgdGhyb3dzIGVycm9yIGZvciBjb3JyZWN0IGBwb2ludGAgdmFsdWVzXG4gICAgICAgIC8vIGFsd2F5cyB0aHJvd3MgZXJyb3IgZm9yIG5lZ2F0aXZlIHZhbHVlc1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0V2luZG93UG9zaXRpb24gKCk6IFByb21pc2U8QXhpc1ZhbHVlczxudW1iZXI+PiB7XG4gICAgY29uc3QgeyBSdW50aW1lIH0gPSBjbGllbnRzTWFuYWdlci5nZXRDbGllbnQoKTtcblxuICAgIGNvbnN0IGFyZ3M6IFByb3RvY29sLlJ1bnRpbWUuRXZhbHVhdGVSZXF1ZXN0ID0ge1xuICAgICAgICBleHByZXNzaW9uOiBgKHtcbiAgICAgICAgICAgIHg6IHdpbmRvdy5zY3JlZW5MZWZ0IHx8IHdpbmRvdy5zY3JlZW5YLFxuICAgICAgICAgICAgeTogd2luZG93LnNjcmVlblRvcCB8fCB3aW5kb3cuc2NyZWVuWVxuICAgICAgICB9KWAsXG4gICAgICAgIHJldHVybkJ5VmFsdWU6IHRydWUsXG4gICAgfTtcblxuICAgIGNvbnN0IHsgcmVzdWx0IH0gPSBhd2FpdCBSdW50aW1lLmV2YWx1YXRlKGFyZ3MpO1xuXG4gICAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn1cbiJdfQ==