"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const execution_context_1 = __importDefault(require("./execution-context"));
const clients_manager_1 = require("./clients-manager");
const adapter_1 = require("../../../../../../shared/adapter");
const domUtils = __importStar(require("./utils/dom-utils"));
const positionUtils = __importStar(require("./utils/position-utils"));
const styleUtils = __importStar(require("./utils/style-utils"));
const eventUtils = __importStar(require("./utils/event-utils"));
const create_event_sequence_1 = __importDefault(require("./utils/create-event-sequence"));
adapter_1.initializeAdapter({
    PromiseCtor: Promise,
    nativeMethods: {
        setTimeout,
        clearTimeout,
        arrayIndexOf: Array.prototype.indexOf,
        arraySplice: Array.prototype.splice,
        arraySlice: Array.prototype.slice,
        arrayFilter: Array.prototype.filter,
        objectAssign: Object.assign,
        objectKeys: Object.keys,
        dateNow: Date.now,
    },
    scroll: async (el, opts) => {
        let currCxt = execution_context_1.default.current;
        let result = null;
        let margin = void 0;
        do {
            const { exceptionDetails, result: resultObj } = await clients_manager_1.getClient().Runtime.callFunctionOn({
                returnByValue: true,
                awaitPromise: true,
                executionContextId: execution_context_1.default.getCurrentContextId(),
                arguments: [{ objectId: el.objectId }, { value: opts }, { value: margin }],
                functionDeclaration: `function (el, opts) {
                    return window["%proxyless%"].scroll(el, opts);
                }`,
            });
            if (exceptionDetails)
                throw exceptionDetails;
            const scrollResult = resultObj.value;
            if (currCxt && currCxt !== currCxt.parent) {
                // TODO:
                //el           = findIframeByWindow(currCxt);
                currCxt = currCxt.parent;
                result = result !== null && result !== void 0 ? result : scrollResult.scrollWasPerformed;
                margin = scrollResult.maxScrollMargin;
                opts.offsetX = scrollResult.offsetX;
                opts.offsetY = scrollResult.offsetY;
            }
        } while (currCxt && currCxt !== currCxt.parent);
        return result;
    },
    browser: { isChrome: true },
    featureDetection: {
        isTouchDevice: false,
    },
    createEventSequence: create_event_sequence_1.default,
    sendRequestToFrame: () => { },
    getElementExceptUI: positionUtils.getElementFromPoint,
    dom: domUtils,
    position: positionUtils,
    style: styleUtils,
    event: eventUtils,
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmVkLWFkYXB0ZXItaW5pdGlhbGl6ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvYnJvd3Nlci9wcm92aWRlci9idWlsdC1pbi9kZWRpY2F0ZWQvY2hyb21lL2NkcC1jbGllbnQvc2hhcmVkLWFkYXB0ZXItaW5pdGlhbGl6ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNEVBQW1EO0FBR25ELHVEQUE4QztBQUM5Qyw4REFBcUU7QUFHckUsNERBQThDO0FBQzlDLHNFQUF3RDtBQUN4RCxnRUFBa0Q7QUFDbEQsZ0VBQWtEO0FBQ2xELDBGQUFnRTtBQUdoRSwyQkFBaUIsQ0FBQztJQUNkLFdBQVcsRUFBRSxPQUFPO0lBRXBCLGFBQWEsRUFBRTtRQUNYLFVBQVU7UUFDVixZQUFZO1FBQ1osWUFBWSxFQUFFLEtBQUssQ0FBQyxTQUFTLENBQUMsT0FBTztRQUNyQyxXQUFXLEVBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNO1FBQ3BDLFVBQVUsRUFBSSxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUs7UUFDbkMsV0FBVyxFQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsTUFBTTtRQUNwQyxZQUFZLEVBQUUsTUFBTSxDQUFDLE1BQU07UUFDM0IsVUFBVSxFQUFJLE1BQU0sQ0FBQyxJQUFJO1FBQ3pCLE9BQU8sRUFBTyxJQUFJLENBQUMsR0FBRztLQUN6QjtJQUVELE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBYyxFQUFFLElBQW1CLEVBQUUsRUFBRTtRQUNsRCxJQUFJLE9BQU8sR0FBRywyQkFBZ0IsQ0FBQyxPQUFrQyxDQUFDO1FBQ2xFLElBQUksTUFBTSxHQUFJLElBQXNCLENBQUM7UUFDckMsSUFBSSxNQUFNLEdBQUksS0FBSyxDQUFzQyxDQUFDO1FBRTFELEdBQUc7WUFDQyxNQUFNLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLE1BQU0sMkJBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUM7Z0JBQ3JGLGFBQWEsRUFBUSxJQUFJO2dCQUN6QixZQUFZLEVBQVMsSUFBSTtnQkFDekIsa0JBQWtCLEVBQUcsMkJBQWdCLENBQUMsbUJBQW1CLEVBQUU7Z0JBQzNELFNBQVMsRUFBWSxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQztnQkFDcEYsbUJBQW1CLEVBQUU7O2tCQUVuQjthQUNMLENBQUMsQ0FBQztZQUVILElBQUksZ0JBQWdCO2dCQUNoQixNQUFNLGdCQUFnQixDQUFDO1lBRTNCLE1BQU0sWUFBWSxHQUFHLFNBQVMsQ0FBQyxLQUE4QixDQUFDO1lBRTlELElBQUksT0FBTyxJQUFJLE9BQU8sS0FBSyxPQUFPLENBQUMsTUFBTSxFQUFFO2dCQUN2QyxRQUFRO2dCQUNSLDZDQUE2QztnQkFDN0MsT0FBTyxHQUFRLE9BQU8sQ0FBQyxNQUFNLENBQUM7Z0JBQzlCLE1BQU0sR0FBUyxNQUFNLGFBQU4sTUFBTSxjQUFOLE1BQU0sR0FBSSxZQUFZLENBQUMsa0JBQWtCLENBQUM7Z0JBQ3pELE1BQU0sR0FBUyxZQUFZLENBQUMsZUFBZSxDQUFDO2dCQUM1QyxJQUFJLENBQUMsT0FBTyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxPQUFPLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQzthQUN2QztTQUVKLFFBQ00sT0FBTyxJQUFJLE9BQU8sS0FBSyxPQUFPLENBQUMsTUFBTSxFQUFFO1FBRTlDLE9BQU8sTUFBaUIsQ0FBQztJQUM3QixDQUFDO0lBRUQsT0FBTyxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRTtJQUUzQixnQkFBZ0IsRUFBRTtRQUNkLGFBQWEsRUFBRSxLQUFLO0tBQ3ZCO0lBRUQsbUJBQW1CLEVBQW5CLCtCQUFtQjtJQUVuQixrQkFBa0IsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBRTdCLGtCQUFrQixFQUFFLGFBQWEsQ0FBQyxtQkFBbUI7SUFDckQsR0FBRyxFQUFpQixRQUFRO0lBQzVCLFFBQVEsRUFBWSxhQUFhO0lBQ2pDLEtBQUssRUFBZSxVQUFVO0lBQzlCLEtBQUssRUFBZSxVQUFVO0NBQ2pDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBFeGVjdXRpb25Db250ZXh0IGZyb20gJy4vZXhlY3V0aW9uLWNvbnRleHQnO1xuaW1wb3J0IHsgU2VydmVyTm9kZSB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgU2Nyb2xsT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uLy4uL3Rlc3QtcnVuL2NvbW1hbmRzL29wdGlvbnMnO1xuaW1wb3J0IHsgZ2V0Q2xpZW50IH0gZnJvbSAnLi9jbGllbnRzLW1hbmFnZXInO1xuaW1wb3J0IHsgaW5pdGlhbGl6ZUFkYXB0ZXIgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi8uLi9zaGFyZWQvYWRhcHRlcic7XG5pbXBvcnQgeyBMZWZ0VG9wVmFsdWVzIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vLi4vc2hhcmVkL3V0aWxzL3ZhbHVlcy9heGlzLXZhbHVlcyc7XG5pbXBvcnQgeyBTY3JvbGxSZXN1bHRQcm94eWxlc3MgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi8uLi9jbGllbnQvY29yZS9zY3JvbGwnO1xuaW1wb3J0ICogYXMgZG9tVXRpbHMgZnJvbSAnLi91dGlscy9kb20tdXRpbHMnO1xuaW1wb3J0ICogYXMgcG9zaXRpb25VdGlscyBmcm9tICcuL3V0aWxzL3Bvc2l0aW9uLXV0aWxzJztcbmltcG9ydCAqIGFzIHN0eWxlVXRpbHMgZnJvbSAnLi91dGlscy9zdHlsZS11dGlscyc7XG5pbXBvcnQgKiBhcyBldmVudFV0aWxzIGZyb20gJy4vdXRpbHMvZXZlbnQtdXRpbHMnO1xuaW1wb3J0IGNyZWF0ZUV2ZW50U2VxdWVuY2UgZnJvbSAnLi91dGlscy9jcmVhdGUtZXZlbnQtc2VxdWVuY2UnO1xuXG5cbmluaXRpYWxpemVBZGFwdGVyKHtcbiAgICBQcm9taXNlQ3RvcjogUHJvbWlzZSxcblxuICAgIG5hdGl2ZU1ldGhvZHM6IHtcbiAgICAgICAgc2V0VGltZW91dCxcbiAgICAgICAgY2xlYXJUaW1lb3V0LFxuICAgICAgICBhcnJheUluZGV4T2Y6IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLFxuICAgICAgICBhcnJheVNwbGljZTogIEFycmF5LnByb3RvdHlwZS5zcGxpY2UsXG4gICAgICAgIGFycmF5U2xpY2U6ICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLFxuICAgICAgICBhcnJheUZpbHRlcjogIEFycmF5LnByb3RvdHlwZS5maWx0ZXIsXG4gICAgICAgIG9iamVjdEFzc2lnbjogT2JqZWN0LmFzc2lnbixcbiAgICAgICAgb2JqZWN0S2V5czogICBPYmplY3Qua2V5cyxcbiAgICAgICAgZGF0ZU5vdzogICAgICBEYXRlLm5vdyxcbiAgICB9LFxuXG4gICAgc2Nyb2xsOiBhc3luYyAoZWw6IFNlcnZlck5vZGUsIG9wdHM6IFNjcm9sbE9wdGlvbnMpID0+IHtcbiAgICAgICAgbGV0IGN1cnJDeHQgPSBFeGVjdXRpb25Db250ZXh0LmN1cnJlbnQgYXMgRXhlY3V0aW9uQ29udGV4dCB8IG51bGw7XG4gICAgICAgIGxldCByZXN1bHQgID0gbnVsbCBhcyBib29sZWFuIHwgbnVsbDtcbiAgICAgICAgbGV0IG1hcmdpbiAgPSB2b2lkIDAgYXMgdW5kZWZpbmVkIHwgTGVmdFRvcFZhbHVlczxudW1iZXI+O1xuXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZXhjZXB0aW9uRGV0YWlscywgcmVzdWx0OiByZXN1bHRPYmogfSA9IGF3YWl0IGdldENsaWVudCgpLlJ1bnRpbWUuY2FsbEZ1bmN0aW9uT24oe1xuICAgICAgICAgICAgICAgIHJldHVybkJ5VmFsdWU6ICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgYXdhaXRQcm9taXNlOiAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICBleGVjdXRpb25Db250ZXh0SWQ6ICBFeGVjdXRpb25Db250ZXh0LmdldEN1cnJlbnRDb250ZXh0SWQoKSxcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6ICAgICAgICAgICBbeyBvYmplY3RJZDogZWwub2JqZWN0SWQgfSwgeyB2YWx1ZTogb3B0cyB9LCB7IHZhbHVlOiBtYXJnaW4gfV0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb25EZWNsYXJhdGlvbjogYGZ1bmN0aW9uIChlbCwgb3B0cykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2luZG93W1wiJXByb3h5bGVzcyVcIl0uc2Nyb2xsKGVsLCBvcHRzKTtcbiAgICAgICAgICAgICAgICB9YCxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhjZXB0aW9uRGV0YWlscylcbiAgICAgICAgICAgICAgICB0aHJvdyBleGNlcHRpb25EZXRhaWxzO1xuXG4gICAgICAgICAgICBjb25zdCBzY3JvbGxSZXN1bHQgPSByZXN1bHRPYmoudmFsdWUgYXMgU2Nyb2xsUmVzdWx0UHJveHlsZXNzO1xuXG4gICAgICAgICAgICBpZiAoY3VyckN4dCAmJiBjdXJyQ3h0ICE9PSBjdXJyQ3h0LnBhcmVudCkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE86XG4gICAgICAgICAgICAgICAgLy9lbCAgICAgICAgICAgPSBmaW5kSWZyYW1lQnlXaW5kb3coY3VyckN4dCk7XG4gICAgICAgICAgICAgICAgY3VyckN4dCAgICAgID0gY3VyckN4dC5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICAgICAgID0gcmVzdWx0ID8/IHNjcm9sbFJlc3VsdC5zY3JvbGxXYXNQZXJmb3JtZWQ7XG4gICAgICAgICAgICAgICAgbWFyZ2luICAgICAgID0gc2Nyb2xsUmVzdWx0Lm1heFNjcm9sbE1hcmdpbjtcbiAgICAgICAgICAgICAgICBvcHRzLm9mZnNldFggPSBzY3JvbGxSZXN1bHQub2Zmc2V0WDtcbiAgICAgICAgICAgICAgICBvcHRzLm9mZnNldFkgPSBzY3JvbGxSZXN1bHQub2Zmc2V0WTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICAgIHdoaWxlIChjdXJyQ3h0ICYmIGN1cnJDeHQgIT09IGN1cnJDeHQucGFyZW50KTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0IGFzIGJvb2xlYW47XG4gICAgfSxcblxuICAgIGJyb3dzZXI6IHsgaXNDaHJvbWU6IHRydWUgfSxcblxuICAgIGZlYXR1cmVEZXRlY3Rpb246IHtcbiAgICAgICAgaXNUb3VjaERldmljZTogZmFsc2UsXG4gICAgfSxcblxuICAgIGNyZWF0ZUV2ZW50U2VxdWVuY2UsXG5cbiAgICBzZW5kUmVxdWVzdFRvRnJhbWU6ICgpID0+IHsgfSxcblxuICAgIGdldEVsZW1lbnRFeGNlcHRVSTogcG9zaXRpb25VdGlscy5nZXRFbGVtZW50RnJvbVBvaW50LFxuICAgIGRvbTogICAgICAgICAgICAgICAgZG9tVXRpbHMsXG4gICAgcG9zaXRpb246ICAgICAgICAgICBwb3NpdGlvblV0aWxzLFxuICAgIHN0eWxlOiAgICAgICAgICAgICAgc3R5bGVVdGlscyxcbiAgICBldmVudDogICAgICAgICAgICAgIGV2ZW50VXRpbHMsXG59KTtcbiJdfQ==