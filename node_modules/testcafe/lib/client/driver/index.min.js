window["%hammerhead%"].utils.removeInjectedScript(),function wl(vl){var _l=vl.document;!function(u,_,y,n,e){var s="default"in u?u.default:u,t="default"in _?_.default:_,r="default"in y?y.default:y;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var o={},i=s.nativeMethods,a=s.Promise,l=s.utils,c=l.browser,d=l.featureDetection,h=r.domUtils,f=r.positionUtils,p=r.styleUtils,m=r.eventUtils,g=t.getOffsetOptions;!function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var r=n[e];o[r]=t[r]}}({PromiseCtor:a,nativeMethods:i,getOffsetOptions:g,dom:h,position:f,style:p,event:m,browser:c,featureDetection:d,getElementExceptUI:function(){return a.resolve()},scroll:function(){return a.resolve()},createEventSequence:function(){},sendRequestToFrame:function(){return a.resolve()}});var w=function(t,e){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function v(t,e){function n(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function E(t,s,a,l){return new(a=a||n)(function(n,e){function r(t){try{o(l.next(t))}catch(t){e(t)}}function i(t){try{o(l.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((l=l.apply(t,s||[])).next())})}function C(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var I,S,W=Math.floor(399);(S=I=I||{}).ready="ready",S.readyForBrowserManipulation="ready-for-browser-manipulation",S.waitForFileDownload="wait-for-file-download";var T=I,b={dispatchEvent:"dispatch-event",click:"click",rightClick:"right-click",doubleClick:"double-click",drag:"drag",dragToElement:"drag-to-element",hover:"hover",scroll:"scroll",scrollBy:"scroll-by",scrollIntoView:"scroll-into-view",typeText:"type-text",selectText:"select-text",selectTextAreaContent:"select-text-area-content",selectEditableContent:"select-editable-content",pressKey:"press-key",wait:"wait",navigateTo:"navigate-to",setFilesToUpload:"set-files-to-upload",clearUpload:"clear-upload",executeClientFunction:"execute-client-function",executeSelector:"execute-selector",takeScreenshot:"take-screenshot",takeElementScreenshot:"take-element-screenshot",takeScreenshotOnFail:"take-screenshot-on-fail",prepareBrowserManipulation:"prepare-browser-manipulation",showAssertionRetriesStatus:"show-assertion-retries-status",hideAssertionRetriesStatus:"hide-assertion-retries-status",setBreakpoint:"set-breakpoint",resizeWindow:"resize-window",resizeWindowToFitDevice:"resize-window-to-fit-device",maximizeWindow:"maximize-window",switchToIframe:"switch-to-iframe",switchToMainWindow:"switch-to-main-window",openWindow:"open-window",closeWindow:"close-window",getCurrentWindow:"get-current-window",getCurrentWindows:"get-current-windows",switchToWindow:"switch-to-window",switchToWindowByPredicate:"switch-to-window-by-predicate",switchToParentWindow:"switch-to-parent-window",switchToPreviousWindow:"switch-to-previous-window",setNativeDialogHandler:"set-native-dialog-handler",getNativeDialogHistory:"get-native-dialog-history",getBrowserConsoleMessages:"get-browser-console-messages",getActiveElement:"get-active-element",setTestSpeed:"set-test-speed",setPageLoadTimeout:"set-page-load-timeout",debug:"debug",disableDebug:"disable-debug",assertion:"assertion",useRole:"useRole",testDone:"test-done",backupStorages:"backup-storages",executeExpression:"execute-expression",executeAsyncExpression:"execute-async-expression",unlockPage:"unlock-page",closeChildWindowOnFileDownloading:"close-child-window-on-file-downloading",recorder:"recorder",prepareClientEnvironmentInDebugMode:"prepare-client-environment-in-debug-mode"},A="E1",N="E4",x="E5",R="E9",D="E10",M="E11",P="E12",F="E24",k="E26",L="E27",O="E28",U="E29",H="E30",B="E31",G="E32",V="E33",q="E34",z="E35",j="E36",X="E37",Y="E39",K="E40",J="E41",$="E42",Q="E43",Z="E44",tt="E45",et="E46",nt="E49",rt="E50",it="E51",ot="E52",st="E57",at="E64",lt="E65",ct="E68",ut="E69",dt="E70",ht="E71",ft="E72",pt="E73",mt="E74",gt="E76",wt="E77",vt="E78",_t="E82",yt="E83";function Et(t){return!(function(t){return t.type===b.executeClientFunction||t.type===b.executeSelector}(r=t)||r.type===b.wait||r.type===b.assertion||r.type===b.executeExpression||It(t)||(n=t).type===b.testDone||n.type===b.showAssertionRetriesStatus||n.type===b.hideAssertionRetriesStatus||n.type===b.setBreakpoint||n.type===b.takeScreenshotOnFail||n.type===b.recorder)||Ct(t)&&!((e=t).type===b.switchToIframe||e.type===b.switchToMainWindow);var e,n,r}function Ct(t){return t.type===b.resizeWindow||t.type===b.resizeWindowToFitDevice||t.type===b.maximizeWindow}function It(t){return(e=t).type===b.takeScreenshot||e.type===b.takeElementScreenshot||e.type===b.takeScreenshotOnFail||Ct(t);var e}function St(t,e){this.code=t,this.isTestCafeError=!0,this.callsite=e||null}var Wt,Tt="step",bt=(v(At,Wt=St),At);function At(t,e,n){var r=Wt.call(this,t)||this;return r.optionName=e,r.actualValue=n,r}var Nt,xt=(v(Rt,Nt=St),Rt);function Rt(t,e){var n=Nt.call(this,nt,e)||this;return n.instantiationCallsiteName=t,n}var Dt,Mt=(v(Pt,Dt=St),Pt);function Pt(t,e){var n=Dt.call(this,rt,e)||this;return n.instantiationCallsiteName=t,n}var Ft,kt=(v(Lt,Ft=St),Lt);function Lt(t,e,n){var r=e.apiFnChain,i=e.apiFnIndex,o=Ft.call(this,t,n)||this;return o.apiFnChain=r,o.apiFnIndex=i,o}var Ot,Ut=(v(Ht,Ot=St),Ht);function Ht(t){return Ot.call(this,it,t)||this}var Bt,Gt=(v(Vt,Bt=kt),Vt);function Vt(t,e){return Bt.call(this,ot,e,t)||this}var qt,zt=(v(jt,qt=St),jt);function jt(t,e){var n=qt.call(this,A)||this;return n.errStack=t,n.pageDestUrl=e,n}var Xt,Yt=(v(Kt,Xt=St),Kt);function Kt(t,e,n){var r=Xt.call(this,N,n)||this;return r.errMsg=String(e),r.instantiationCallsiteName=t,r}var Jt,$t=(v(Qt,Jt=St),Qt);function Qt(t,e,n,r){var i=Jt.call(this,x,r)||this;return i.errMsg=String(e),i.property=n,i.instantiationCallsiteName=t,i}var Zt,te=(v(ee,Zt=St),ee);function ee(t){var e=Zt.call(this,at)||this;return e.errMsg=String(t),e}var ne,re=(v(ie,ne=St),ie);function ie(t,e){var n=ne.call(this,lt)||this;return n.errMsg=String(t),n.moduleName=e,n}var oe,se=(v(ae,oe=bt),ae);function ae(t,e){return oe.call(this,R,t,e)||this}var le,ce=(v(ue,le=bt),ue);function ue(t,e){return le.call(this,D,t,e)||this}var de,he=(v(fe,de=bt),fe);function fe(t,e){return de.call(this,M,t,e)||this}var pe,me=(v(ge,pe=bt),ge);function ge(t,e){return pe.call(this,P,t,e)||this}var we,ve=(v(_e,we=kt),_e);function _e(t,e){return we.call(this,F,e,t)||this}var ye,Ee=(v(Ce,ye=St),Ce);function Ce(t){return ye.call(this,k,t)||this}var Ie,Se=(v(We,Ie=St),We);function We(t){var e=Ie.call(this,L)||this;return e.nodeDescription=t,e}var Te,be=(v(Ae,Te=kt),Ae);function Ae(t,e){var n=Te.call(this,O,e)||this;return n.argumentName=t,n}var Ne,xe=(v(Re,Ne=St),Re);function Re(t){var e=Ne.call(this,U)||this;return e.argumentName=t,e}var De,Me=(v(Pe,De=St),Pe);function Pe(t,e){var n=De.call(this,H)||this;return n.argumentName=t,n.nodeDescription=e,n}var Fe,ke=(v(Le,Fe=St),Le);function Le(){return Fe.call(this,B)||this}var Oe,Ue=(v(He,Oe=St),He);function He(){return Oe.call(this,G)||this}var Be,Ge=(v(Ve,Be=St),Ve);function Ve(t){var e=Be.call(this,V)||this;return e.argumentName=t,e}var qe,ze=(v(je,qe=St),je);function je(){return qe.call(this,z)||this}var Xe,Ye=(v(Ke,Xe=St),Ke);function Ke(t){var e=Xe.call(this,j)||this;return e.argumentName=t,e}var Je,$e=(v(Qe,Je=St),Qe);function Qe(t,e){var n=Je.call(this,X)||this;return n.filePaths=t,n.scannedFilePaths=e,n}var Ze,tn=(v(en,Ze=St),en);function en(){return Ze.call(this,q)||this}var nn,rn=(v(on,nn=St),on);function on(t,e){var n=nn.call(this,J)||this;return n.properties=t?"scrollTargetY property":e?"scrollTargetX property":"scrollTargetX and scrollTargetY properties",n}var sn,an=(v(ln,sn=St),ln);function ln(t,e){var n=sn.call(this,st)||this;return t<=0?e<=0?(n.verb="are",n.dimensions="width and height"):(n.verb="is",n.dimensions="width"):(n.verb="is",n.dimensions="height"),n}var cn,un=(v(dn,cn=St),dn);function dn(t){return cn.call(this,K,t)||this}var hn,fn=(v(pn,hn=St),pn);function pn(){return hn.call(this,Y)||this}var mn,gn=(v(wn,mn=St),wn);function wn(){return mn.call(this,$)||this}var vn,_n=(v(yn,vn=St),yn);function yn(){return vn.call(this,ut)||this}var En,Cn=(v(In,En=St),In);function In(){return En.call(this,ct)||this}var Sn,Wn=(v(Tn,Sn=St),Tn);function Tn(){return Sn.call(this,dt)||this}var bn,An=(v(Nn,bn=St),Nn);function Nn(){return bn.call(this,ht)||this}var xn,Rn=(v(Dn,xn=St),Dn);function Dn(){return xn.call(this,pt)||this}var Mn,Pn=(v(Fn,Mn=St),Fn);function Fn(){return Mn.call(this,_t)||this}var kn,Ln=(v(On,kn=St),On);function On(t){var e=kn.call(this,vt)||this;return e.errMsg=t,e}var Un,Hn=(v(Bn,Un=St),Bn);function Bn(){return Un.call(this,mt)||this}var Gn,Vn=(v(qn,Gn=St),qn);function qn(){return Gn.call(this,gt)||this}var zn,jn=(v(Xn,zn=St),Xn);function Xn(){return zn.call(this,wt)||this}var Yn,Kn=(v(Jn,Yn=St),Jn);function Jn(){return Yn.call(this,ft)||this}var $n,Qn=(v(Zn,$n=St),Zn);function Zn(){return $n.call(this,yt)||this}var tr,er=(v(nr,tr=St),nr);function nr(){return tr.call(this,Q)||this}var rr,ir=(v(or,rr=St),or);function or(){return rr.call(this,Z)||this}var sr,ar=(v(lr,sr=St),lr);function lr(t,e){var n=sr.call(this,tt)||this;return n.dialogType=t,n.pageUrl=e,n}var cr,ur=(v(dr,cr=St),dr);function dr(t,e,n){var r=cr.call(this,et)||this;return r.dialogType=t,r.errMsg=e,r.pageUrl=n,r}var hr=Object.freeze({__proto__:null,TestRunErrorBase:St,ClientFunctionExecutionInterruptionError:xt,DomNodeClientFunctionResultError:Mt,SelectorErrorBase:kt,InvalidSelectorResultError:Ut,CannotObtainInfoForElementSpecifiedBySelectorError:Gt,UncaughtErrorOnPage:zt,UncaughtErrorInClientFunctionCode:Yt,UncaughtErrorInCustomDOMPropertyCode:$t,UncaughtErrorInCustomClientScriptCode:te,UncaughtErrorInCustomClientScriptLoadedFromModule:re,ActionIntegerOptionError:se,ActionPositiveIntegerOptionError:ce,ActionBooleanOptionError:he,ActionSpeedOptionError:me,ActionElementNotFoundError:ve,ActionElementIsInvisibleError:Ee,ActionSelectorMatchesWrongNodeTypeError:Se,ActionAdditionalElementNotFoundError:be,ActionAdditionalElementIsInvisibleError:xe,ActionAdditionalSelectorMatchesWrongNodeTypeError:Me,ActionElementNonEditableError:ke,ActionElementNotTextAreaError:Ue,ActionElementNonContentEditableError:Ge,ActionRootContainerNotFoundError:ze,ActionIncorrectKeysError:Ye,ActionCannotFindFileToUploadError:$e,ActionElementIsNotFileInputError:tn,ActionInvalidScrollTargetError:rn,InvalidElementScreenshotDimensionsError:an,ActionElementNotIframeError:un,ActionIframeIsNotLoadedError:fn,CurrentIframeIsNotLoadedError:gn,ChildWindowNotFoundError:_n,ChildWindowIsNotLoadedError:Cn,CannotSwitchToWindowError:Wn,CloseChildWindowError:An,CannotCloseWindowWithChildrenError:Rn,CannotCloseWindowWithoutParentError:Pn,SwitchToWindowPredicateError:Ln,WindowNotFoundError:Hn,ParentWindowNotFoundError:Vn,PreviousWindowNotFoundError:jn,ChildWindowClosedBeforeSwitchingError:Kn,CannotRestoreChildWindowError:Qn,CurrentIframeNotFoundError:er,CurrentIframeIsInvisibleError:ir,NativeDialogNotHandledError:ar,UncaughtErrorInNativeDialogHandler:ur}),fr="_nativeMethods",pr=(mr.prototype._ensureNativeMethods=function(t){return t||{objectKeys:Object.keys,arrayForEach:Array.prototype.forEach,arrayConcat:Array.prototype.concat,arraySlice:Array.prototype.slice,objectDefineProperty:Object.defineProperty}},mr.prototype._getWindowIds=function(t){return this[fr].objectKeys(t)},mr.prototype._copyArray=function(t){return this[fr].arraySlice.call(t)},mr.prototype._concatArrays=function(t,e){return this[fr].arrayConcat.call(t,e)},mr.prototype.ensureMessageContainer=function(t){this[t]||(this[t]={log:[],info:[],warn:[],error:[]})},mr.prototype.concat=function(e){var n=this;if(!e)return this;var t=this._getWindowIds(e);return this[fr].arrayForEach.call(t,function(t){n.ensureMessageContainer(t),n[t].log=n._concatArrays(n[t].log,e[t].log),n[t].info=n._concatArrays(n[t].info,e[t].info),n[t].warn=n._concatArrays(n[t].warn,e[t].warn),n[t].error=n._concatArrays(n[t].error,e[t].error)}),this},mr.prototype.addMessage=function(t,e,n){this.ensureMessageContainer(n),this[n][t].push(e)},mr.prototype.getCopy=function(){var e=this,n={},t=this._getWindowIds(this);return this[fr].arrayForEach.call(t,function(t){n[t]={log:e._copyArray(e[t].log),info:e._copyArray(e[t].info),warn:e._copyArray(e[t].warn),error:e._copyArray(e[t].error)}}),n},mr);function mr(t,e){var n=this._ensureNativeMethods(e);n.objectDefineProperty(this,fr,{value:n}),this.concat(t)}var gr,wr=(v(vr,gr=pr),vr);function vr(t){return gr.call(this,t,u.nativeMethods)||this}var _r,yr=(function(t){function n(t){return!!s[t]}function r(t,e){this.references=t,this.transforms=e,this.circularCandidates=[],this.circularCandidatesDescrs=[],this.circularRefCount=0}var o=/^#*@(t|r)$/,i=(0,eval)("this"),s={Int8Array:"function"==typeof Int8Array?Int8Array:void 0,Uint8Array:"function"==typeof Uint8Array?Uint8Array:void 0,Uint8ClampedArray:"function"==typeof Uint8ClampedArray?Uint8ClampedArray:void 0,Int16Array:"function"==typeof Int16Array?Int16Array:void 0,Uint16Array:"function"==typeof Uint16Array?Uint16Array:void 0,Int32Array:"function"==typeof Int32Array?Int32Array:void 0,Uint32Array:"function"==typeof Uint32Array?Uint32Array:void 0,Float32Array:"function"==typeof Float32Array?Float32Array:void 0,Float64Array:"function"==typeof Float64Array?Float64Array:void 0},a="function"==typeof ArrayBuffer,l="function"==typeof Map,c="function"==typeof Set,u="function"==typeof Buffer,d=Array.prototype.slice,e={serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return JSON.parse(t)}};function h(t,e){this.references=t,this.transformMap=e,this.activeTransformsStack=[],this.visitedRefs=Object.create(null)}r._createRefMark=function(t){var e=Object.create(null);return e["@r"]=t,e},r.prototype._createCircularCandidate=function(t,e,n){this.circularCandidates.push(t),this.circularCandidatesDescrs.push({parent:e,key:n,refIdx:-1})},r.prototype._applyTransform=function(t,e,n,r){var i=Object.create(null),o=r.toSerializable(t);return"object"==typeof o&&this._createCircularCandidate(t,e,n),i["@t"]=r.type,i.data=this._handleValue(o,e,n),i},r.prototype._handleArray=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=this._handleValue(t[n],e,n);return e},r.prototype._handlePlainObject=function(n){var r=this,i=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){var e=o.test(t)?"#"+t:t;i[e]=r._handleValue(n[t],i,e)}),i},r.prototype._handleObject=function(t,e,n){return this._createCircularCandidate(t,e,n),Array.isArray(t)?this._handleArray(t):this._handlePlainObject(t)},r.prototype._ensureCircularReference=function(t){var e=this.circularCandidates.indexOf(t);if(-1<e){var n=this.circularCandidatesDescrs[e];return-1===n.refIdx&&(n.refIdx=n.parent?++this.circularRefCount:0),r._createRefMark(n.refIdx)}return null},r.prototype._handleValue=function(t,e,n){var r=typeof t,i="object"==r&&null!==t;if(i){var o=this._ensureCircularReference(t);if(o)return o}for(var s=0;s<this.transforms.length;s++){var a=this.transforms[s];if(a.shouldTransform(r,t))return this._applyTransform(t,e,n,a)}return i?this._handleObject(t,e,n):t},r.prototype.transform=function(){for(var t=[this._handleValue(this.references,null,null)],e=0;e<this.circularCandidatesDescrs.length;e++){var n=this.circularCandidatesDescrs[e];0<n.refIdx&&(t[n.refIdx]=n.parent[n.key],n.parent[n.key]=r._createRefMark(n.refIdx))}return t},h.prototype._handlePlainObject=function(e){var t,n=this,r=Object.create(null),i=Object.getOwnPropertyNames(e);for(t in i.forEach(function(t){n._handleValue(e[t],e,t),o.test(t)&&(r[t.substring(1)]=e[t],delete e[t])}),r)e[t]=r[t]},h.prototype._handleTransformedObject=function(t,e,n){var r=t["@t"],i=this.transformMap[r];if(!i)throw new Error("Can't find transform for \""+r+'" type.');this.activeTransformsStack.push(t),this._handleValue(t.data,t,"data"),this.activeTransformsStack.pop(),e[n]=i.fromSerializable(t.data)},h.prototype._handleCircularSelfRefDuringTransform=function(t,e,n){var r=this.references,i=void 0;Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){return void 0===i&&(i=r[t]),i},set:function(t){return i=t}})},h.prototype._handleCircularRef=function(t,e,n){-1<this.activeTransformsStack.indexOf(this.references[t])?this._handleCircularSelfRefDuringTransform(t,e,n):(this.visitedRefs[t]||(this.visitedRefs[t]=!0,this._handleValue(this.references[t],this.references,t)),e[n]=this.references[t])},h.prototype._handleValue=function(t,e,n){if("object"==typeof t&&null!==t){var r=t["@r"];if(void 0!==r)this._handleCircularRef(r,e,n);else if(t["@t"])this._handleTransformedObject(t,e,n);else if(Array.isArray(t))for(var i=0;i<t.length;i++)this._handleValue(t[i],t,i);else this._handlePlainObject(t)}},h.prototype.transform=function(){return this.visitedRefs[0]=!0,this._handleValue(this.references[0],this.references,0),this.references[0]};var f=[{type:"[[NaN]]",shouldTransform:function(t,e){return"number"===t&&isNaN(e)},toSerializable:function(){return""},fromSerializable:function(){return NaN}},{type:"[[undefined]]",shouldTransform:function(t){return"undefined"===t},toSerializable:function(){return""},fromSerializable:function(){}},{type:"[[Date]]",shouldTransform:function(t,e){return e instanceof Date},toSerializable:function(t){return t.getTime()},fromSerializable:function(t){var e=new Date;return e.setTime(t),e}},{type:"[[RegExp]]",shouldTransform:function(t,e){return e instanceof RegExp},toSerializable:function(t){var e={src:t.source,flags:""};return t.global&&(e.flags+="g"),t.ignoreCase&&(e.flags+="i"),t.multiline&&(e.flags+="m"),e},fromSerializable:function(t){return new RegExp(t.src,t.flags)}},{type:"[[Error]]",shouldTransform:function(t,e){return e instanceof Error},toSerializable:function(t){return{name:t.name,message:t.message,stack:t.stack}},fromSerializable:function(t){var e=new(i[t.name]||Error)(t.message);return e.stack=t.stack,e}},{type:"[[ArrayBuffer]]",shouldTransform:function(t,e){return a&&e instanceof ArrayBuffer},toSerializable:function(t){var e=new Int8Array(t);return d.call(e)},fromSerializable:function(t){if(a){var e=new ArrayBuffer(t.length);return new Int8Array(e).set(t),e}return t}},{type:"[[Buffer]]",shouldTransform:function(t,e){return u&&e instanceof Buffer},toSerializable:function(t){return d.call(t)},fromSerializable:function(t){return u?Buffer.from(t):t}},{type:"[[TypedArray]]",shouldTransform:function(t,e){return Object.keys(s).some(function(t){return n(t)&&e instanceof s[t]})},toSerializable:function(t){return{ctorName:t.constructor.name,arr:d.call(t)}},fromSerializable:function(t){return n(t.ctorName)?new s[t.ctorName](t.arr):t.arr}},{type:"[[Map]]",shouldTransform:function(t,e){return l&&e instanceof Map},toSerializable:function(t){var n=[];return t.forEach(function(t,e){n.push(e),n.push(t)}),n},fromSerializable:function(t){if(l){for(var e=new Map,n=0;n<t.length;n+=2)e.set(t[n],t[n+1]);return e}for(var r=[],i=0;i<t.length;i+=2)r.push([t[n],t[n+1]]);return r}},{type:"[[Set]]",shouldTransform:function(t,e){return c&&e instanceof Set},toSerializable:function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},fromSerializable:function(t){if(c){for(var e=new Set,n=0;n<t.length;n++)e.add(t[n]);return e}return t}}],p=t.exports=function(t){this.transforms=[],this.transformsMap=Object.create(null),this.serializer=t||e,this.addTransforms(f)};p.prototype.addTransforms=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++){var n=t[e];if(this.transformsMap[n.type])throw new Error('Transform with type "'+n.type+'" was already added.');this.transforms.push(n),this.transformsMap[n.type]=n}return this},p.prototype.removeTransforms=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++){var n=t[e],r=this.transforms.indexOf(n);-1<r&&this.transforms.splice(r,1),delete this.transformsMap[n.type]}return this},p.prototype.encode=function(t){var e=new r(t,this.transforms).transform();return this.serializer.serialize(e)},p.prototype.decode=function(t){var e=this.serializer.deserialize(t);return new h(e,this.transformsMap).transform()}}(_r={exports:{}}),_r.exports),Er=function(t){return t};function Cr(t){return new yr({serialize:Er,deserialize:Er}).addTransforms(t)}var Ir,Sr={};function Wr(t){return!(!Sr.isDomElement(t)&&!Sr.isTextNode(t))&&(Sr.isOptionElement(t)||"optgroup"===Sr.getTagName(t)?Sr.isOptionElementVisible(t):Sr.isElementVisible(t))}var Tr=1,br=2,Ar=3,Nr=((Ir={})[Tr]=/^\.filterVisible\(\)$/,Ir[br]=/^\.filterHidden\(\)$/,Ir[Ar]=/^\.nth\(\d+\)$/,Ir);function xr(){this._err=null}var Rr=(Object.defineProperty(xr.prototype,"error",{get:function(){return this._err},set:function(t){null===this._err&&(this._err=t)},enumerable:!1,configurable:!0}),xr.prototype.filter=function(t,e,n){if(e.filterVisible&&(t=t.filter(Wr),this._assertFilterError(t,n,Tr)),e.filterHidden&&(t=t.filter(function(t){return!Wr(t)}),this._assertFilterError(t,n,br)),e.counterMode)return null===e.index?t.length:xr._getNodeByIndex(t,e.index)?1:0;var r;if(e.collectionMode)return null!==e.index&&(t=(r=xr._getNodeByIndex(t,e.index))?[r]:[],this._assertFilterError(t,n,Ar)),t;var i=xr._getNodeByIndex(t,e.index||0);return i||(this.error=xr._getErrorItem(n,Ar)),i},xr.prototype.cast=function(t){if(null==t)return[];if(t instanceof Sr.nativeMethods.Node)return[t];if(function(t){if(Sr.nativeMethods.isArray(t)){for(var e=0;e<t.length;e++)if(!(t[e]instanceof Sr.nativeMethods.Node))return;return 1}}(t))return t;if((e=t)instanceof Sr.nativeMethods.HTMLCollection||e instanceof Sr.nativeMethods.NodeList)return function(t){for(var e=t.length,n=[],r=0;r<e;r++)n.push(t[r]);return n}(t);var e;throw new Ut},xr.prototype._assertFilterError=function(t,e,n){0===t.length&&(this.error=xr._getErrorItem(e,n))},xr._getErrorItem=function(t,e){var n=t.apiFnChain,r=t.apiFnID;if(e)for(var i=r;i<n.length;i++)if(Nr[e].test(n[i]))return i;return null},xr._getNodeByIndex=function(t,e){return e<0?t[t.length+e]:t[e]},new xr);function Dr(t,e){var n=Sr.nativeMethods.Function;return Sr.isProxyless?new n("fnCode","__dependencies$",'"use strict"; return eval(fnCode)')(t,e):new n("fnCode","__dependencies$","Promise","RegExp",'"use strict"; return eval(fnCode)')(t,e,Sr.PromiseCtor,RegExp)}var Mr=(Pr.prototype.shouldTransform=function(t){return"function"===t},Pr.prototype.toSerializable=function(){return""},Pr.prototype.fromSerializable=function(t){var e=t.fnCode,n=t.dependencies;return"filterOptions"in n&&(n.selectorFilter=Rr),Dr(e,n)},Pr);function Pr(){this.type="Function"}var Fr=(kr.prototype.shouldTransform=function(t,e){if(e instanceof Sr.nativeMethods.Node)throw new Mt(this._instantiationCallsiteName);return!1},kr.prototype.toSerializable=function(){},kr.prototype.fromSerializable=function(){},kr);function kr(t){this.type="Node",this._instantiationCallsiteName=t}var Lr=(Or.prototype.getResult=function(){var e=this;return Sr.PromiseCtor.resolve().then(function(){var t=e.replicator.decode(e.command.args);return e._executeFn(t)}).catch(function(t){throw t.isTestCafeError||Sr.isProxyless||(t=new Yt(e.command.instantiationCallsiteName,t)),t})},Or.prototype.encodeResult=function(t){return this.replicator.encode(t)},Or.prototype._createReplicator=function(){return Cr([new Fr(this.command.instantiationCallsiteName),new Mr])},Or.prototype._executeFn=function(t){return this.fn.apply(vl,t)},Or);function Or(t){this.command=t,this.replicator=this._createReplicator(),this.dependencies=this.replicator.decode(t.dependencies),this.fn=Dr(t.fnCode,this.dependencies)}var Ur="appeared-dialog",Hr="unexpected-dialog",Br="handler-error",Gr=s.eventSandbox.message,Vr=s.processScript,qr=s.nativeMethods,zr="testcafe|native-dialog-tracker|appeared-dialogs",jr="testcafe|native-dialog-tracker|unexpected-dialog",Xr="testcafe|native-dialog-tracker|error-in-handler",Yr=Vr("window.location.href"),Kr=(Object.defineProperty(Jr.prototype,"appearedDialogs",{get:function(){var t=this.contextStorage.getItem(zr);return t||(t=[],this.appearedDialogs=t),t},set:function(t){this.contextStorage.setItem(zr,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Jr.prototype,"unexpectedDialog",{get:function(){return this.contextStorage.getItem(jr)},set:function(t){this.contextStorage.setItem(jr,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Jr.prototype,"handlerError",{get:function(){return this.contextStorage.getItem(Xr)},set:function(t){this.contextStorage.setItem(Xr,t)},enumerable:!1,configurable:!0}),Jr._getPageUrl=function(){return qr.eval(Yr)},Jr.prototype._initListening=function(){var n=this;Gr.on(Gr.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message;e.type===Ur?n._addAppearedDialogs(e.dialogType,e.text,e.url):e.type!==Hr||n.unexpectedDialog?e.type!==Br||n.handlerError||n._onHandlerError(e.dialogType,e.message,e.url):n.unexpectedDialog={type:e.dialogType,url:e.url}})},Jr.prototype._init=function(){var e=this;s.on(s.EVENTS.beforeUnload,function(t){t.prevented&&!t.isFakeIEEvent&&(e.dialogHandler?e._createDialogHandler("beforeunload")(t.returnValue||""):e._defaultDialogHandler("beforeunload")),e.contextStorage&&e.contextStorage.save()}),vl.alert=function(){return e._defaultDialogHandler("alert")},vl.confirm=function(){return e._defaultDialogHandler("confirm")},vl.prompt=function(){return e._defaultDialogHandler("prompt")}},Jr.prototype._createDialogHandler=function(i){var o=this;return function(t){var e=Jr._getPageUrl();o._addAppearedDialogs(i,t,e);var n=new Lr(o.dialogHandler),r=null;try{r=n.fn.apply(vl,[i,t,e])}catch(t){o._onHandlerError(i,t.message||String(t),e)}return r}},Jr.prototype._defaultDialogHandler=function(t){var e=Jr._getPageUrl();this.unexpectedDialog=this.unexpectedDialog||{type:t,url:e}},Jr.prototype._addAppearedDialogs=function(t,e,n){this.appearedDialogs.splice(0,0,{type:t,text:e,url:n})},Jr.prototype._onHandlerError=function(t,e,n){this.handlerError=this.handlerError||{type:t,message:e,url:n}},Jr.prototype.setHandler=function(t){var e=this;this.dialogHandler=t,["alert","confirm","prompt"].forEach(function(t){vl[t]=e.dialogHandler?e._createDialogHandler(t):function(){return e._defaultDialogHandler(t)}})},Jr.prototype.getUnexpectedDialogError=function(){var t=this.unexpectedDialog,e=this.handlerError;return this.unexpectedDialog=null,this.handlerError=null,t?new ar(t.type,t.url):e?new ur(e.type,e.message,e.url):null},Jr);function Jr(t,e){this.contextStorage=t,this.dialogHandler=e,this._init(),this._initListening(),this.dialogHandler&&this.setHandler(e)}function $r(){return u.nativeMethods.performanceNow().toString()}function Qr(t){this.type=t,this.id=$r()}var Zr,ti="driver|establish-connection",ei="driver|switch-to-window",ni="driver|close-window",ri="driver|close-window-validation",ii="driver|switch-to-window-validation",oi="driver|get-windows",si="driver|command-executed",ai="driver|execute-command",li="driver|confirmation",ci="driver|set-native-dialog-handler",ui="driver|set-as-master",di="driver|close-all-child-windows",hi="driver|start-to-restore-child-link",fi="driver|restore-child-link",pi="driver|child-window-is-loaded-in-iframe",mi="driver|child-window-is-opened-in-iframe",gi="driver|stop-internal-from-iframe",wi="driver|has-pending-action-flags",vi=(v(_i,Zr=Qr),_i);function _i(){return Zr.call(this,ti)||this}var yi,Ei=(v(Ci,yi=Qr),Ci);function Ci(t){var e=t.windowId,n=yi.call(this,ri)||this;return n.windowId=e,n}var Ii,Si=(v(Wi,Ii=Qr),Wi);function Wi(t){var e=t.windowId,n=t.fn,r=Ii.call(this,ii)||this;return r.windowId=e,r.fn=n,r}var Ti,bi=(v(Ai,Ti=Qr),Ai);function Ai(){return Ti.call(this,oi)||this}var Ni,xi=(v(Ri,Ni=Qr),Ri);function Ri(t){var e=t.windowId,n=t.isCurrentWindow,r=Ni.call(this,ni)||this;return r.windowId=e,r.isCurrentWindow=n,r}var Di,Mi=(v(Pi,Di=Qr),Pi);function Pi(t){var e=t.windowId,n=t.fn,r=Di.call(this,ei)||this;return r.windowId=e,r.fn=n,r}var Fi,ki=(v(Li,Fi=Qr),Li);function Li(t){var e=Fi.call(this,si)||this;return e.driverStatus=t,e}var Oi,Ui=(v(Hi,Oi=Qr),Hi);function Hi(t,e){var n=Oi.call(this,ai)||this;return n.command=t,n.testSpeed=e,n}var Bi,Gi=(v(Vi,Bi=Qr),Vi);function Vi(t,e){var n=Bi.call(this,li)||this;return n.requestMessageId=t,n.result=e,n}var qi,zi=(v(ji,qi=Qr),ji);function ji(t){var e=qi.call(this,ci)||this;return e.dialogHandler=t,e}var Xi,Yi=(v(Ki,Xi=Qr),Ki);function Ki(t){var e=Xi.call(this,ui)||this;return e.finalizePendingCommand=t,e}var Ji,$i=(v(Qi,Ji=Qr),Qi);function Qi(){return Ji.call(this,di)||this}var Zi,to=(v(eo,Zi=Qr),eo);function eo(){return Zi.call(this,hi)||this}var no,ro=(v(io,no=Qr),io);function io(t){var e=no.call(this,fi)||this;return e.windowId=t,e}var oo,so=(v(ao,oo=Qr),ao);function ao(t){var e=oo.call(this,pi)||this;return e.windowId=t,e}var lo,co=(v(uo,lo=Qr),uo);function uo(){return lo.call(this,mi)||this}var ho,fo=(v(po,ho=Qr),po);function po(){return ho.call(this,gi)||this}var mo,go=(v(wo,mo=Qr),wo);function wo(){return mo.call(this,wi)||this}var vo=s.json,_o=s.nativeMethods,yo=(Eo.prototype._createStorageKey=function(t,e){var n="testcafe|driver|"+t;return e?n+"|"+e:n},Eo.prototype._loadFromStorage=function(){var t=_o.storageGetItem.call(this.storage,this.storageKey);t&&(this.data=vo.parse(t),_o.storageRemoveItem.call(this.storage,this.storageKey))},Eo.prototype.save=function(){_o.storageSetItem.call(this.storage,this.storageKey,vo.stringify(this.data))},Eo.prototype.setItem=function(t,e){this.data[t]=e,this.save()},Eo.prototype.getItem=function(t){return this.data[t]},Eo.prototype.dispose=function(){_o.storageRemoveItem.call(this.storage,this.storageKey)},Eo);function Eo(t,e,n){this.storage=_o.winSessionStorageGetter.call(t),this.storageKey=this._createStorageKey(e,n),this.data={},this._loadFromStorage()}var Co=(Io.prototype._getAssignableProperties=function(){throw new Error("Not implemented")},Io.prototype._assignFrom=function(t,e,n){if(void 0===n&&(n={}),t)for(var r=this._getAssignableProperties(),i=0;i<r.length;i++){for(var o,s=r[i],a=s.name,l=s.type,c=s.required,u=s.init,d=s.defaultValue,h=a.split("."),f=h.length-1,p=h[f],m=t,g=this,w=0;w<f&&m&&g;w++)m=m[h[w]],g=g[h[w]];g&&"defaultValue"in r[i]&&(g[a]=d),m&&g&&(void 0===(o=m[p])&&!c||(e&&l&&l(a,o),g[p]=u?u(a,o,n,e):o))}},Io);function Io(){}var So,Wo=(v(To,So=Co),To.prototype._getAssignableProperties=function(){return[{name:"isCommandResult"},{name:"executionError"},{name:"pageError"},{name:"result"},{name:"consoleMessages"},{name:"isPendingWindowSwitching"},{name:"isObservingFileDownloadingInNewWindow"},{name:"isFirstRequestAfterWindowSwitching"}]},To);function To(t){var e=So.call(this,t)||this;return e.id=$r(),e.isCommandResult=!1,e.executionError=null,e.pageError=null,e.resent=!1,e.result=null,e.consoleMessages=null,e.isPendingWindowSwitching=!1,e.isObservingFileDownloadingInNewWindow=!1,e.isFirstRequestAfterWindowSwitching=!1,e.debug="",e._assignFrom(t,!0),e}function bo(n,t,e,r){var i=null,o=null,s=null;return e=Math.max(e||0,2500),u.Promise.race([y.delay(e),new u.Promise(function(e){s=function(t){t.message.type===li&&t.message.requestMessageId===n.id&&e(t.message)},u.eventSandbox.message.on(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),i=u.nativeMethods.setInterval.call(vl,function(){return u.eventSandbox.message.sendServiceMsg(n,t)},1e3),u.eventSandbox.message.sendServiceMsg(n,t)})]).then(function(t){if(u.nativeMethods.clearInterval.call(vl,i),u.nativeMethods.clearTimeout.call(vl,o),u.eventSandbox.message.off(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),!t)throw new r;return t})}var Ao=2e4;function No(t){var e=t.requestMsgId,n=t.result,r=t.window,i=new Gi(e,n);u.eventSandbox.message.sendServiceMsg(i,r)}var xo=(Object.defineProperty(Ro.prototype,"availabilityTimeout",{set:function(t){this.iframeAvailabilityTimeout=t},enumerable:!1,configurable:!0}),Ro.prototype._ensureIframe=function(){var t=this;return y.domUtils.isElementInDocument(this.driverIframe)?y.waitFor(function(){return y.positionUtils.isElementVisible(t.driverIframe)?t.driverIframe:null},200,this.iframeAvailabilityTimeout).catch(function(){throw new ir}):u.Promise.reject(new er)},Ro.prototype._waitForIframeRemovedOrHidden=function(){var e=this;return new u.Promise(function(t){e.checkIframeInterval=u.nativeMethods.setInterval.call(vl,function(){e._ensureIframe().catch(function(){return y.delay(500).then(function(){return t(new Wo({isCommandResult:!0}))})})},1e3)})},Ro.prototype._waitForCommandResult=function(){var e=this,n=null;return u.Promise.race([this._waitForIframeRemovedOrHidden(),new u.Promise(function(e){n=function(t){t.message.type===si&&e(t.message.driverStatus)},u.eventSandbox.message.on(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n)})]).then(function(t){return u.eventSandbox.message.off(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n),u.nativeMethods.clearInterval.call(vl,e.checkIframeInterval),t})},Ro.prototype.sendConfirmationMessage=function(t){No({requestMsgId:t,result:{id:this.driverId},window:this.driverWindow})},Ro.prototype.executeCommand=function(e,n){var r=this;return this._ensureIframe().then(function(){var t=new Ui(e,n);return u.Promise.all([bo(t,r.driverWindow,r.iframeAvailabilityTimeout,gn),r._waitForCommandResult()])}).then(function(t){return t[1]})},Ro);function Ro(t,e){this.driverWindow=t,this.driverIframe=y.domUtils.findIframeByWindow(t),this.driverId=e,this.iframeAvailabilityTimeout=0}var Do=["nodeType","textContent","childNodeCount","hasChildNodes","childElementCount","hasChildElements"],Mo=["tagName","attributes"],Po=["tagName","visible","focused","attributes","boundingClientRect","classNames","style","innerText","namespaceURI","id","value","checked","selected","selectedIndex","scrollWidth","scrollHeight","scrollLeft","scrollTop","offsetWidth","offsetHeight","offsetLeft","offsetTop","clientWidth","clientHeight","clientLeft","clientTop"],Fo={childNodeCount:function(t){return t.childNodes.length},hasChildNodes:function(t){return!!Fo.childNodeCount(t)},childElementCount:function(t){var e=t.children;if(e)return e.length;for(var n=0,r=t.childNodes.length,i=0;i<r;i++)1===t.childNodes[i].nodeType&&n++;return n},hasChildElements:function(t){return!!Fo.childElementCount(t)}},ko=(Lo.prototype._initializeProperties=function(t,e,n){for(var r=0,i=e;r<i.length;r++){var o=i[r],s=n[o];this[o]=s?s(t):t[o]}},Lo);function Lo(){}var Oo,Uo=(v(Ho,Oo=ko),Ho);function Ho(t){var e=Oo.call(this)||this;return e._initializeProperties(t,Do,Fo),e}var Bo,Go={tagName:function(t){return t.tagName.toLowerCase()},visible:function(t){return Sr.isElementVisible(t)},focused:function(t){return Sr.getActiveElement()===t},attributes:function(t){for(var e=t.attributes,n={},r=e.length-1;0<=r;r--)n[e[r].name]=e[r].value;return n},boundingClientRect:function(t){var e=t.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}},classNames:function(t){var e=t.className;return"string"==typeof e.animVal&&(e=e.animVal),e.replace(/^\s+|\s+$/g,"").split(/\s+/g)},style:function(t){for(var e={},n=vl.getComputedStyle(t),r=0;r<n.length;r++){var i=n[r];e[i]=n[i]}return e},innerText:function(t){return t.innerText}},Vo=(v(qo,Bo=ko),qo);function qo(t){var e=Bo.call(this)||this;return e._initializeProperties(t,Mo,Go),e}var zo,jo=(v(Xo,zo=Uo),Xo);function Xo(t){var e=zo.call(this,t)||this;return e._initializeProperties(t,Po,Go),e}var Yo=(Ko.prototype._extend=function(t,e){for(var n=0,r=Sr.nativeMethods.objectKeys(this._customDOMProperties);n<r.length;n++){var i=r[n];try{t[i]=this._customDOMProperties[i](e)}catch(t){throw new $t(this._instantiationCallsiteName,t,i)}}},Ko.prototype.shouldTransform=function(t,e){return e instanceof Sr.nativeMethods.Node},Ko.prototype.toSerializable=function(t){var e=new(1===t.nodeType?jo:Uo)(t);return this._extend(e,t),e},Ko.prototype.fromSerializable=function(){},Ko);function Ko(t,e){void 0===t&&(t={}),this.type="Node",this._customDOMProperties=t,this._instantiationCallsiteName=e}var Jo=($o.prototype.on=function(t,e){this._eventsListeners[t]||(this._eventsListeners[t]=[]),this._eventsListeners[t].push(e)},$o.prototype.once=function(n,r){var i=this;this.on(n,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i.off(n,r),r.apply(void 0,t)})},$o.prototype.off=function(t,e){var n=this._eventsListeners[t];n&&(this._eventsListeners[t]=o.nativeMethods.arrayFilter.call(n,function(t){return t!==e}))},$o.prototype.offAll=function(t){t?this._eventsListeners[t]=[]:this._eventsListeners={}},$o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this._eventsListeners[e];if(r)for(var i=0;i<r.length;i++)try{r[i].apply(this,t)}catch(t){if(!(t.message&&-1<t.message.indexOf("freed script")))throw t;this.off(e,r[i])}},$o);function $o(){this._eventsListeners={}}function Qo(e){var n=o.nativeMethods.setTimeout;return new o.PromiseCtor(function(t){return n(t,e)})}var Zo="elementIsInvisibleError",ts="foundElementIsNotTarget",es={1:"element",2:"attribute",3:"text",4:"cdata section",5:"entity reference",6:"entity node",7:"processing instruction",8:"comment",9:"document",10:"document type",11:"document fragment",12:"notation"},ns=(rs.prototype.push=function(t,r){var i=this;this._ensureElementsPromise=this._ensureElementsPromise.then(function(){return i._executeSelectorFn(t,{invisible:r?{name:"ActionAdditionalElementIsInvisibleError",firstArg:r}:"ActionElementIsInvisibleError",notFound:r?{name:"ActionAdditionalElementNotFoundError",firstArg:r}:"ActionElementNotFoundError"},i._ensureElementsStartTime)}).then(function(t){if(!o.dom.isDomElement(t)){var e=t.nodeType,n=es[e];throw r?new Me(r,n):new Se(n)}i._elements.push(t)})},rs.prototype.getElements=function(){var t=this;return this._ensureElementsPromise.then(function(){return t._elements})},rs);function rs(t,e){this._globalSelectorTimeout=t,this._ensureElementsStartTime=o.nativeMethods.dateNow(),this._ensureElementsPromise=o.PromiseCtor.resolve(),this._executeSelectorFn=e,this._elements=[]}var is,os=(v(ss,is=Jo),ss.prototype._delayAfterExecution=function(){return this._command.options&&1!==this._command.options.speed?Qo(2e3*(1-this._command.options.speed)):o.PromiseCtor.resolve()},ss.prototype._isExecutionTimeoutExpired=function(){return o.nativeMethods.dateNow()-this._executionStartTime>=this._commandSelectorTimeout},ss.prototype._ensureCommandArguments=function(){var t=ss.ACTIONS_HANDLERS[this._command.type];null!=t&&t.ensureCmdArgs&&t.ensureCmdArgs(this._command)},ss.prototype._ensureCommandElements=function(){var t,e=this,n=new ns(this._globalSelectorTimeout,this._executeSelectorFn);this._command.selector&&n.push(this._command.selector);var r=null===(t=ss.ACTIONS_HANDLERS[this._command.type])||void 0===t?void 0:t.additionalSelectorProps;if(r)for(var i=0,o=r;i<o.length;i++){var s=o[i];this._command[s]&&n.push(this._command[s],s)}return n.getElements().then(function(t){e._elements=t})},ss.prototype._ensureCommandElementsProperties=function(){var t=ss.ACTIONS_HANDLERS[this._command.type];null!=t&&t.ensureElsProps&&t.ensureElsProps(this._elements)},ss.prototype._ensureCommandOptions=function(){var t,e,n,r=this._command.options;this._elements.length&&r&&"offsetX"in r&&"offsetY"in r&&(e=(t=o.getOffsetOptions(this._elements[0],r.offsetX,r.offsetY)).offsetX,n=t.offsetY,r.offsetX=e,r.offsetY=n)},ss.prototype._createAutomation=function(){var t=ss.ACTIONS_HANDLERS[this._command.type];if(!t)throw new Error('There is no handler for the "'+this._command.type+'" command.');return t.create(this._command,this._elements)},ss.prototype._runAction=function(e){var n=this;return this._ensureCommandElements().then(function(){return n._ensureCommandElementsProperties()}).then(function(){n._ensureCommandOptions();var t=n._createAutomation();return t.TARGET_ELEMENT_FOUND_EVENT?t.on(t.TARGET_ELEMENT_FOUND_EVENT,function(t){n._targetElement=t.element,n.emit(ss.EXECUTION_STARTED_EVENT)}):n.emit(ss.EXECUTION_STARTED_EVENT),t.run(e)})},ss.prototype._runRecursively=function(){var e=this,t=!1,n=!0;return function(e,n){return E(this,void 0,void 0,function(){return C(this,function(t){switch(t.label){case 0:return e()?[4,n()]:[3,2];case 1:return t.sent(),[3,0];case 2:return[2]}})})}(function(){return!t},function(){return e._runAction(n).then(function(){t=!0}).catch(function(t){if(!e._isExecutionTimeoutExpired())return Qo(250);if(t.message===ts)return n=!1,o.PromiseCtor.resolve();throw t.message===Zo?new Ee:t})})},ss.prototype.execute=function(t){var e=this;this._executionStartTime=o.nativeMethods.dateNow();try{this._ensureCommandArguments()}catch(t){return o.PromiseCtor.reject(t)}return this.emit(ss.WAITING_FOR_ELEMENT_EVENT,this._commandSelectorTimeout),this._runRecursively().then(function(){return n.all([e._delayAfterExecution(),t.wait()])}).then(function(){var t=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(e._elements);return e._targetElement&&(t[0]=e._targetElement),t})},ss.EXECUTION_STARTED_EVENT="execution-started",ss.WAITING_FOR_ELEMENT_EVENT="waiting-for-elements",ss.ACTIONS_HANDLERS={},ss);function ss(t,e,n,r){var i,o=is.call(this)||this;return o._command=t,o._targetElement=null,o._elements=[],o._globalSelectorTimeout=e,o._executionStartTime=0,o._executeSelectorFn=r,t.options&&!t.options.speed&&(t.options.speed=n),o._commandSelectorTimeout="number"==typeof(null===(i=t.selector)||void 0===i?void 0:i.timeout)?t.selector.timeout:e,o}function as(t,e,n){return Math.min(Math.max(e,t),n)}function ls(t,e){var n="number"==typeof t.min,r="number"==typeof t.max,i="number"==typeof t.length;return i&&(t.length=as(t.length,0,e)),n&&t.min<0&&(t.min+=e),r&&t.max<0&&(t.max+=e),n||(t.min=r&&i?t.max-t.length:0),r||(t.max=i?t.min+t.length:e),t.min=as(t.min,0,e),t.max=as(t.max,0,e),t.length=t.max-t.min,t}function cs(t,e,n){return Math.round(t+as(e-t,0,n)/2)}var us,ds=(v(hs,us=Lr),hs.prototype._createReplicator=function(){return Cr([new Mr])},hs.prototype._getTimeoutErrorParams=function(){return{apiFnIndex:Rr.error,apiFnChain:this.command.apiFnChain}},hs.prototype._getTimeoutError=function(t){return t?this.createIsInvisibleError:this.createNotFoundError},hs.prototype._validateElement=function(s,a){var l=this;return Sr.PromiseCtor.resolve().then(function(){return us.prototype._executeFn.call(l,s)}).then(function(t){var e=t,n=!!e,r=!l.command.visibilityCheck||e&&Wr(e),i=Sr.nativeMethods.dateNow()-a>=l.timeout;if(n&&(r||Sr.isShadowRoot(e)))return e;if(!i)return Sr.delay(200).then(function(){return l._validateElement(s,a)});var o=l.getVisibleValueMode?null:l._getTimeoutError(n);if(o)throw o(l._getTimeoutErrorParams());return null})},hs.prototype._executeFn=function(t){return this.counterMode?us.prototype._executeFn.call(this,t):this._validateElement(t,Sr.nativeMethods.dateNow())},hs);function hs(t,e,n,r,i){var o,s=us.call(this,t)||this;s.createNotFoundError=r,s.createIsInvisibleError=i,s.timeout="number"==typeof t.timeout?t.timeout:e,s.counterMode=s.dependencies.filterOptions.counterMode,s.getVisibleValueMode=s.dependencies.filterOptions.getVisibleValueMode,s.dependencies.selectorFilter=Rr,n&&(o=Sr.nativeMethods.dateNow()-n,s.timeout=Math.max(s.timeout-o,0));var a=s.dependencies.customDOMProperties;return s.replicator.addTransforms([new Yo(a,t.instantiationCallsiteName)]),s}var fs=u.nativeMethods.date,ps=(ms.prototype._ensureElement=function(t){var e=this,n=t.selector,r=t.createNotFoundError,i=t.createIsInvisibleError,o=t.createHasWrongNodeTypeError;this.ensureElementsPromise=this.ensureElementsPromise.then(function(){return new ds(n,e.globalSelectorTimeout,e.ensureElementsStartTime,r,i).getResult()}).then(function(t){if(!y.domUtils.isDomElement(t))throw o(es[t.nodeType]);e.elements.push(t)})},ms.prototype.getElements=function(){var t=this;return this.ensureElementsPromise.then(function(){return t.elements})},ms);function ms(t,e){var n=this;this.elements=[],this.globalSelectorTimeout=e,this.ensureElementsPromise=u.Promise.resolve(),this.ensureElementsStartTime=new fs,t.forEach(function(t){return n._ensureElement(t)})}function gs(r){return function(t,e){var n=typeof e;if("number"!=n)throw new r(t,n);if(isNaN(e)||!isFinite(e)||e!==Math.floor(e))throw new r(t,e)}}var ws,vs,_s,ys,Es,Cs=gs(se),Is=(vs=gs(ws=ce),function(t,e){if(vs(t,e),e<0)throw new ws(t,e)}),Ss=(_s=he,function(t,e){var n=typeof e;if("boolean"!=n)throw new _s(t,n)}),Ws=(ys=me,function(t,e){var n=typeof e;if("number"!=n)throw new ys(t,n);if(isNaN(e)||e<.01||1<e)throw new ys(t,e)}),Ts=(v(bs,Es=Co),bs.prototype._getAssignableProperties=function(){return[{name:"speed",type:Ws}]},bs);function bs(t,e){var n=Es.call(this)||this;return n.speed=null,n._assignFrom(t,e),n}var As,Ns=(v(xs,As=Ts),xs.prototype._getAssignableProperties=function(){return As.prototype._getAssignableProperties.call(this).concat([{name:"offsetX",type:Cs},{name:"offsetY",type:Cs}])},xs);function xs(t,e){var n=As.call(this)||this;return n.offsetX=null,n.offsetY=null,n._assignFrom(t,e),n}var Rs,Ds=(v(Ms,Rs=Ns),Ms.prototype._getAssignableProperties=function(){return Rs.prototype._getAssignableProperties.call(this).concat([{name:"scrollToCenter",type:Ss},{name:"skipParentFrames",type:Ss}])},Ms);function Ms(t,e){var n=Rs.call(this)||this;return n.scrollToCenter=!1,n.skipParentFrames=!1,n._assignFrom(t,e),n}var Ps,Fs=(v(ks,Ps=Ts),ks.prototype._getAssignableProperties=function(){return Ps.prototype._getAssignableProperties.call(this).concat([{name:"scrollTargetX",type:Cs},{name:"scrollTargetY",type:Cs},{name:"crop.left",type:Cs},{name:"crop.right",type:Cs},{name:"crop.top",type:Cs},{name:"crop.bottom",type:Cs},{name:"includeMargins",type:Ss},{name:"includeBorders",type:Ss},{name:"includePaddings",type:Ss}])},ks);function ks(t,e){var n=Ps.call(this)||this;return n.scrollTargetX=null,n.scrollTargetY=null,n.includeMargins=!1,n.includeBorders=!0,n.includePaddings=!0,n.crop={left:null,right:null,top:null,bottom:null},n._assignFrom(t,e),n}var Ls,Os=(v(Us,Ls=Ns),Us.prototype._getAssignableProperties=function(){return Ls.prototype._getAssignableProperties.call(this).concat([{name:"modifiers.ctrl",type:Ss},{name:"modifiers.alt",type:Ss},{name:"modifiers.shift",type:Ss},{name:"modifiers.meta",type:Ss}])},Us);function Us(t,e){var n=Ls.call(this)||this;return n.modifiers={ctrl:!1,alt:!1,shift:!1,meta:!1},n._assignFrom(t,e),n}var Hs,Bs,Gs,Vs,qs,zs,js,Xs=(v(Ys,Hs=Os),Ys.prototype._getAssignableProperties=function(){return Hs.prototype._getAssignableProperties.call(this).concat([{name:"caretPos",type:Is}])},Ys);function Ys(t,e){var n=Hs.call(this)||this;return n.caretPos=null,n._assignFrom(t,e),n}function Ks(t,e){var n=Bs.call(this)||this;return n.speed=null,n.minMovingTime=null,n.holdLeftButton=!1,n.skipScrolling=!1,n.skipDefaultDragBehavior=!1,n._assignFrom(t,e),n}function Js(t,e){var n=Gs.call(this)||this;return n.replace=!1,n.paste=!1,n.confidential=void 0,n._assignFrom(t,e),n}function $s(t,e){var n=Vs.call(this,t,e)||this;return n.destinationOffsetX=null,n.destinationOffsetY=null,n._assignFrom(t,e),n}function Qs(t,e){var n=qs.call(this)||this;return n.portraitOrientation=!1,n._assignFrom(t,e),n}function Zs(t,e){var n=zs.call(this)||this;return n.timeout=void 0,n.allowUnawaitedPromise=!1,n._assignFrom(t,e),n}function ta(t,e){var n=js.call(this)||this;return n.confidential=void 0,n._assignFrom(t,e),n}function ea(t){return t.top!==t}v(Ks,Bs=Os),Ks.prototype._getAssignableProperties=function(){return Bs.prototype._getAssignableProperties.call(this).concat([{name:"speed"},{name:"minMovingTime"},{name:"holdLeftButton"},{name:"skipScrolling",type:Ss},{name:"skipDefaultDragBehavior",type:Ss}])},v(Js,Gs=Xs),Js.prototype._getAssignableProperties=function(){return Gs.prototype._getAssignableProperties.call(this).concat([{name:"replace",type:Ss},{name:"paste",type:Ss},{name:"confidential",type:Ss}])},v($s,Vs=Os),$s.prototype._getAssignableProperties=function(){return Vs.prototype._getAssignableProperties.call(this).concat([{name:"destinationOffsetX",type:Cs},{name:"destinationOffsetY",type:Cs}])},v(Qs,qs=Co),Qs.prototype._getAssignableProperties=function(){return[{name:"portraitOrientation",type:Ss}]},v(Zs,zs=Co),Zs.prototype._getAssignableProperties=function(){return[{name:"timeout",type:Is},{name:"allowUnawaitedPromise",type:Ss}]},v(ta,js=Ts),ta.prototype._getAssignableProperties=function(){return js.prototype._getAssignableProperties.call(this).concat([{name:"confidential",type:Ss}])};var na=u.eventSandbox.message,ra="driver|browser-manipulation|request",ia="driver|browser-manipulation|response";na.on(na.SERVICE_MSG_RECEIVED_EVENT,function(e){var t,n,r,i,o;e.message.cmd===ra&&(t=y.domUtils.findIframeByWindow(e.source),r=(n=e.message).command,(i=n.cropDimensions)&&(r.options=new Fs({crop:i,includePaddings:!1})),(o=new oa(r)).element=t,o.execute().then(function(t){return na.sendServiceMsg({cmd:ia,result:t},e.source)}))});var oa=(sa.prototype._getAbsoluteCropValues=function(){var t=this.element.getBoundingClientRect(),e=t.top,n=t.left;n+=this.command.options.originOffset.x,e+=this.command.options.originOffset.y;var r=n+this.command.options.crop.right,i=e+this.command.options.crop.bottom;return{top:e+=this.command.options.crop.top,left:n+=this.command.options.crop.left,bottom:i,right:r}},sa.prototype._createManipulationReadyMessage=function(){var t=vl.devicePixelRatio||1,e={cmd:T.readyForBrowserManipulation,pageDimensions:{dpr:t,innerWidth:vl.innerWidth,innerHeight:vl.innerHeight,documentWidth:_l.documentElement.clientWidth,documentHeight:_l.documentElement.clientHeight,bodyWidth:_l.body.clientWidth,bodyHeight:_l.body.clientHeight},disableResending:!0};return this.command.type===b.takeElementScreenshot&&(e.cropDimensions=this._getAbsoluteCropValues()),e},sa.prototype._runScrollBeforeScreenshot=function(){var i=this;return u.Promise.resolve().then(function(){if(i.element||!i.command.selector)return u.Promise.resolve();var t,e,n=i.command.selector.timeout,r="number"==typeof n?n:i.globalSelectorTimeout;return i.statusBar.showWaitingElementStatus(r),t=[{selector:i.command.selector,createNotFoundError:function(t){return new ve(null,t)},createIsInvisibleError:function(){return new Ee},createHasWrongNodeTypeError:function(t){return new Se(t)}}],e=i.globalSelectorTimeout,new ps(t,e).getElements().then(function(t){i.statusBar.hideWaitingElementStatus(),i.element=t[0]}).catch(function(t){throw i.statusBar.hideWaitingElementStatus(),t})}).then(function(){!function(t,e){var n=t.getBoundingClientRect(),r={left:n.left,right:n.right,top:n.top,bottom:n.bottom},i=y.styleUtils.getElementMargin(t),o=y.styleUtils.getElementPadding(t),s=y.styleUtils.getBordersWidth(t);e.originOffset={x:0,y:0};var a=r.left+t.scrollWidth+s.left+s.right,l=r.top+t.scrollHeight+s.top+s.bottom;r.right=Math.max(r.right,a),r.bottom=Math.max(r.bottom,l),e.includeBorders&&e.includePaddings?e.includeMargins&&(e.originOffset.x-=i.left,e.originOffset.y-=i.top,r.left-=i.left,r.top-=i.top,r.right+=i.right,r.bottom+=i.bottom):(e.originOffset.x+=s.left,e.originOffset.y+=s.top,r.left+=s.left,r.top+=s.top,r.right-=s.right,r.bottom-=s.bottom,e.includePaddings||(e.originOffset.x+=o.left,e.originOffset.y+=o.top,r.left+=o.left,r.top+=o.top,r.right-=o.right,r.bottom-=o.bottom)),r.width=r.right-r.left,r.height=r.bottom-r.top;var c=ls({min:e.crop.left,max:e.crop.right,length:e.crop.width},r.width),u=ls({min:e.crop.top,max:e.crop.bottom,length:e.crop.height},r.height);if(e.crop.left=c.min,e.crop.right=c.max,e.crop.width=c.length,e.crop.top=u.min,e.crop.bottom=u.max,e.crop.height=u.length,e.crop.width<=0||e.crop.height<=0)throw new an(e.crop.width,e.crop.height);var d=y.styleUtils.getViewportDimensions();(r.width>d.width||r.height>d.height)&&(e.scrollToCenter=!0);var h="number"==typeof e.scrollTargetX,f="number"==typeof e.scrollTargetY;h||(e.scrollTargetX=cs(e.crop.left,e.crop.right,d.width)),f||(e.scrollTargetY=cs(e.crop.top,e.crop.bottom,d.height));var p=_.getOffsetOptions(t,e.scrollTargetX,e.scrollTargetY),m=p.offsetX,g=p.offsetY;e.scrollTargetX=m,e.scrollTargetY=g;var w=!h||e.scrollTargetX>=e.crop.left&&e.scrollTargetX<=e.crop.right,v=!f||e.scrollTargetY>=e.crop.top&&e.scrollTargetY<=e.crop.bottom;if(!w||!v)throw new rn(w,v)}(i.element,i.command.options);var t=i.command.options,e=t.scrollTargetX,n=t.scrollTargetY,r=t.scrollToCenter;return new y.ScrollAutomation(i.element,new Ds({offsetX:e,offsetY:n,scrollToCenter:r,skipParentFrames:!0})).run()})},sa.prototype._hideUI=function(){return e.hide(),this.command.markData&&e.showScreenshotMark(this.command.markData),y.delay(500)},sa.prototype._showUI=function(){this.command.markData&&e.hideScreenshotMark(),e.show()},sa.prototype._requestManipulation=function(){if(!ea(vl))return u.transport.queuedAsyncServiceMsg(this._createManipulationReadyMessage());var t=this._getAbsoluteCropValues();return y.sendRequestToFrame({cmd:ra,command:this.command,cropDimensions:t},ia,vl.parent).then(function(t){if(!t.result)return{result:null};var e=t.result,n=e.result,r=e.executionError;if(r)throw r;return{result:n}})},sa.prototype._runManipulation=function(){var r=this,i=null;return u.Promise.resolve().then(function(){return r.command.type!==b.takeElementScreenshot?u.Promise.resolve():(y.scrollController.stopPropagation(),r._runScrollBeforeScreenshot())}).then(function(){return ea(vl)?u.Promise.resolve():r._hideUI()}).then(function(){return r._requestManipulation()}).then(function(t){var e=t.result,n=t.error;if(n)throw n;return y.scrollController.enablePropagation(),i=e,ea(vl)||r._showUI(),y.delay(200)}).then(function(){return new Wo({isCommandResult:!0,result:i})}).catch(function(t){return y.scrollController.enablePropagation(),new Wo({isCommandResult:!0,executionError:t})})},sa.prototype.execute=function(){var t=this;return function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=new y.ClientRequestEmitter,i=new y.RequestBarrier(r),o=new y.ScriptExecutionEmitter,s=new y.ScriptExecutionBarrier(o);y.pageUnloadBarrier.watchForPageNavigationTriggers();var a=null,l=t.apply(void 0,e),c=l.then(function(t){return a=t,u.Promise.all([i.wait().then(function(){return s.wait()}),y.pageUnloadBarrier.wait()])}).then(function(){return a});return{actionPromise:l,barriersPromise:c}}(function(){return t._runManipulation()}).barriersPromise},sa);function sa(t,e,n){this.command=t,this.globalSelectorTimeout=e,this.statusBar=n,this.element=null}function aa(e){return e.getResult().then(function(t){return new Wo({isCommandResult:!0,result:e.encodeResult(t)})}).catch(function(t){return new Wo({isCommandResult:!0,executionError:t})})}var la=s.Promise,ca=(ua.prototype.setAsMaster=function(t){var e=this;return bo(new Yi(t),this.driverWindow,Ao,Wn).catch(function(t){if(!e._isNonPageWindow)throw t})},ua.prototype.closeAllChildWindows=function(){return bo(new $i,this.driverWindow,Ao,An)},ua.prototype.findChildWindows=function(t,e){return bo(new e(t),this.driverWindow,Ao,Wn)},ua.prototype.startToRestore=function(){return bo(new to,this.driverWindow,Ao,Wn)},ua.prototype.closeFileDownloadingWindow=function(){this._isNonPageWindow=!0,this.driverWindow.close()},ua);function ua(t,e){this._isNonPageWindow=!1,this.driverWindow=t,this.windowId=e}var da=(ha.prototype._getTopOpenedWindow=function(t){for(var e=t;e.opener;)e=e.opener;return e.top},ha.prototype._setAsMaster=function(t,e){return bo(new Yi(e),t,Ao,Wn)},ha.prototype.getTopOpenedWindow=function(){return this._getTopOpenedWindow(this.currentDriverWindow)},ha.prototype.setTopOpenedWindowAsMaster=function(){var t=this._getTopOpenedWindow(this.currentDriverWindow);return this._setAsMaster(t)},ha.prototype.setParentWindowAsMaster=function(t){void 0===t&&(t={});var e=this.currentDriverWindow.opener;return this._setAsMaster(e,t.finalizePendingCommand)},ha.prototype.restoreChild=function(r){return E(this,void 0,void 0,function(){var e,n;return C(this,function(t){return e=new ro(r),n=this.currentDriverWindow.opener,bo(e,n,Ao,Wn),[2]})})},ha);function ha(t){this.currentDriverWindow=t}var fa="master",pa="replica",ma=(ga.prototype.shouldTransform=function(t,e){return e instanceof Sr.nativeMethods.Node},ga.prototype.toSerializable=function(t){return new Vo(t)},ga.prototype.fromSerializable=function(){},ga);function ga(){this.type="Node"}function wa(e){return new n(function(t){return setTimeout(t,e)})}var va=(_a.prototype._startListening=function(){var e=this;this._emitter.onRequestSend(function(t){return e._onRequestSend(t)}),this._emitter.onRequestCompleted(function(t){return e._onRequestCompleted(t)}),this._emitter.onRequestError(function(t){return e._onRequestError(t)})},_a.prototype._offListening=function(){this._emitter.offAll()},_a.prototype._onRequestSend=function(t){this._collectingReqs&&this._requests.add(t)},_a.prototype._onRequestCompleted=function(t){var e=this;wa(this._delays.additionalRequestsCollection).then(function(){return e._onRequestFinished(t)})},_a.prototype._onRequestFinished=function(t){this._requests.has(t)&&(this._requests.delete(t),this._collectingReqs||this._requests.size||!this._watchdog||this._finishWaiting())},_a.prototype._onRequestError=function(t){this._onRequestFinished(t)},_a.prototype._finishWaiting=function(){this._watchdog&&((0,o.nativeMethods.clearTimeout)(this._watchdog),this._watchdog=null),this._requests.clear(),this._offListening(),this._waitResolve()},_a.prototype.wait=function(t){var n=this;return wa(t?this._delays.pageInitialRequestsCollection:this._delays.requestsCollection).then(function(){return new o.PromiseCtor(function(t){var e;n._collectingReqs=!1,n._waitResolve=t,n._requests.size?(e=o.nativeMethods.setTimeout,n._watchdog=e(function(){return n._finishWaiting()},_a.TIMEOUT)):n._finishWaiting()})})},_a.TIMEOUT=3e3,_a);function _a(t,e){var n,r,i;void 0===e&&(e={}),this._delays={requestsCollection:null!==(n=e.requestsCollection)&&void 0!==n?n:50,additionalRequestsCollection:null!==(r=e.additionalRequestsCollection)&&void 0!==r?r:50,pageInitialRequestsCollection:null!==(i=e.pageInitialRequestsCollection)&&void 0!==i?i:50},this._emitter=t,this._waitResolve=null,this._watchdog=null,this._requests=new Set,this._collectingReqs=!0,this._startListening()}var ya=(Ea.prototype._startListening=function(){var e=this;this._emitter.onScriptAdded(function(t){return e._onScriptElementAdded(t)}),this._emitter.onScriptLoadedOrFailed(function(t){return e._onScriptLoadedOrFailed(t)})},Ea.prototype._offListening=function(){this._emitter.offAll()},Ea.prototype._onScriptElementAdded=function(t){var e=this,n=(0,o.nativeMethods.setTimeout)(function(){return e._onScriptLoadedOrFailed(t,!0)},Ea.LOADING_TIMEOUT);this._scripts.set(t,n)},Ea.prototype._onScriptLoadedOrFailed=function(t,e){var n=this;void 0===e&&(e=!1),this._scripts.has(t)&&(e||(0,o.nativeMethods.clearTimeout)(this._scripts.get(t)),this._scripts.delete(t),this._scripts.size||Qo(25).then(function(){n._waitResolve&&!n._scripts.size&&n._finishWaiting()}))},Ea.prototype._finishWaiting=function(){this._watchdog&&((0,o.nativeMethods.clearTimeout)(this._watchdog),this._watchdog=null),this._scripts.clear(),this._offListening(),this._waitResolve(),this._waitResolve=null},Ea.prototype.wait=function(){var n=this;return new o.PromiseCtor(function(t){var e;n._waitResolve=t,n._scripts.size?(e=o.nativeMethods.setTimeout,n._watchdog=e(function(){return n._finishWaiting()},Ea.TIMEOUT)):n._finishWaiting()})},Ea.TIMEOUT=3e3,Ea.LOADING_TIMEOUT=2e3,Ea);function Ea(t){this._emitter=t,this._watchdog=null,this._waitResolve=null,this._scripts=new Map,this._startListening()}var Ca=(Ia.prototype.wait=function(){var t=this;return o.PromiseCtor.all([this._requestBarrier.wait().then(function(){return t._scriptExecutionBarrier.wait()}),this._unloadBarrier.wait()]).then()},Ia);function Ia(t,e,n){this._requestBarrier=new va(t),this._scriptExecutionBarrier=new ya(e),(this._unloadBarrier=n).watchForPageNavigationTriggers&&n.watchForPageNavigationTriggers()}function Sa(t){var e="string"==typeof t?hr[t]:hr[t.name],n="string"==typeof t?null:t.firstArg;return function(t){return new e(n,t)}}function Wa(t,e){var n=_.calculateSelectTextArguments(e[0],t);return new _.SelectText(e[0],n.startPos,n.endPos,t.options)}function Ta(t){if(!y.domUtils.isFileInput(t))throw new tn}os.ACTIONS_HANDLERS[b.dispatchEvent]={additionalSelectorProps:["relatedTarget"],create:function(t,e){return e[1]&&(t.options.relatedTarget=e[1]),new _.DispatchEvent(e[0],t.eventName,t.options)}},os.ACTIONS_HANDLERS[b.pressKey]={create:function(t){return new _.Press(y.parseKeySequence(t.keys).combinations,t.options)},ensureCmdArgs:function(t){if(y.parseKeySequence(t.keys).error)throw new Ye("keys")}},os.ACTIONS_HANDLERS[b.click]={create:function(t,e){return/option|optgroup/.test(y.domUtils.getTagName(e[0]))?new _.SelectChildClick(e[0],t.options):new _.Click(e[0],t.options)}},os.ACTIONS_HANDLERS[b.rightClick]={create:function(t,e){return new _.RClick(e[0],t.options)}},os.ACTIONS_HANDLERS[b.doubleClick]={create:function(t,e){return new _.DblClick(e[0],t.options)}},os.ACTIONS_HANDLERS[b.hover]={create:function(t,e){return new _.Hover(e[0],t.options)}},os.ACTIONS_HANDLERS[b.drag]={create:function(t,e){return new _.DragToOffset(e[0],t.dragOffsetX,t.dragOffsetY,t.options)}},os.ACTIONS_HANDLERS[b.dragToElement]={additionalSelectorProps:["destinationSelector"],create:function(t,e){return new _.DragToElement(e[0],e[1],t.options)}},os.ACTIONS_HANDLERS[b.scroll]={create:function(t,e){var n=t.x,r=t.y,i=t.position,o=t.options;return new _.SetScroll(e[0],{x:n,y:r,position:i},o)}},os.ACTIONS_HANDLERS[b.scrollBy]={create:function(t,e){var n=t.byX,r=t.byY,i=t.options;return new _.SetScroll(e[0],{byX:n,byY:r},i)}},os.ACTIONS_HANDLERS[b.scrollIntoView]={create:function(t,e){return new _.ScrollIntoView(e[0],t.options)}},os.ACTIONS_HANDLERS[b.typeText]={create:function(t,e){return new _.Type(e[0],t.text,t.options)}},os.ACTIONS_HANDLERS[b.selectText]={create:Wa,ensureElsProps:function(t){if(!y.domUtils.isEditableElement(t[0]))throw new ke}},os.ACTIONS_HANDLERS[b.selectTextAreaContent]={create:Wa,ensureElsProps:function(t){if(!y.domUtils.isTextAreaElement(t[0]))throw new Ue}},os.ACTIONS_HANDLERS[b.selectEditableContent]={additionalSelectorProps:["startSelector","endSelector"],create:function(t,e){return t.endSelector=t.endSelector||t.startSelector,new _.SelectEditableContent(e[0],e[1],t.options)},ensureElsProps:function(t){if(!y.domUtils.isContentEditableElement(t[0]))throw new Ge("startSelector");if(!y.domUtils.isContentEditableElement(t[1]))throw new Ge("endSelector");if(!y.contentEditable.getNearestCommonAncestor(t[0],t[1]))throw new ze}},os.ACTIONS_HANDLERS[b.setFilesToUpload]={create:function(t,e){return new _.Upload(e[0],t.filePath,function(t,e){return new $e(t,e)})},ensureElsProps:function(t){return Ta(t[0])}},os.ACTIONS_HANDLERS[b.clearUpload]={create:function(t,e){return new _.Upload(e[0])},ensureElsProps:function(t){return Ta(t[0])}};var ba,Aa=s.settings,Na=s.transport,xa=s.Promise,Ra=s.eventSandbox.message,Da=s.storages,Ma=s.nativeMethods,Pa=Ma.date,Fa=s.eventSandbox.listeners,ka="testcafe|driver|test-done-sent-flag",La="testcafe|driver|pending-status",Oa="testcafe|driver|executing-client-function-descriptor",Ua="testcafe|driver|selector-execution-start-time",Ha="testcafe|driver|pending-page-error",Ba="testcafe|driver|active-iframe-selector",Ga="testcafe|driver|test-speed",Va="testcafe|driver|assertion-retries-timeout",qa="testcafe|driver|assertion-retries-start-time",za="testcafe|driver|console-messages",ja="testcafe|driver|pending-child-window-count",Xa={NotLoadedError:fn,NotFoundError:ve,IsInvisibleError:Ee},Ya={NotLoadedError:gn,NotFoundError:er,IsInvisibleError:ir},Ka=Math.pow(2,31)-1,Ja="status-with-command-result-event",$a="empty-command-event",Qa="child-window-closed",Za=(v(tl,ba=y.serviceUtils.EventEmitter),tl.prototype._isOpenedInIframe=function(){var t=vl.opener;return t&&t.top&&t.top!==t},Object.defineProperty(tl.prototype,"speed",{get:function(){return this.contextStorage.getItem(Ga)},set:function(t){this.contextStorage.setItem(Ga,t)},enumerable:!1,configurable:!0}),Object.defineProperty(tl.prototype,"consoleMessages",{get:function(){return new wr(this.contextStorage.getItem(za))},set:function(t){return this.contextStorage.setItem(za,t?t.getCopy():null)},enumerable:!1,configurable:!0}),tl.prototype._getReadyPromise=function(){return E(this,void 0,void 0,function(){return C(this,function(t){switch(t.label){case 0:return[4,y.eventUtils.documentReady(this.pageLoadTimeout)];case 1:return t.sent(),[4,this.pageInitialRequestBarrier.wait(!0)];case 2:return t.sent(),[2]}})})},tl.prototype._hasPendingActionFlags=function(t){return t.getItem(this.COMMAND_EXECUTING_FLAG)||t.getItem(this.EXECUTING_IN_IFRAME_FLAG)},tl.prototype._getCurrentWindowId=function(){var t=vl.location.toString(),e=s.utils.url.parseProxyUrl(t);return e&&e.windowId||null},tl.prototype._onJsError=function(t){if(this.skipJsErrors||this.contextStorage.getItem(ka))return xa.resolve();var e=new zt(t.stack,t.pageUrl);return this.contextStorage.getItem(Ha)||this.contextStorage.setItem(Ha,e),null},tl.prototype._unlockPageAfterTestIsDone=function(){return y.disableRealEventsPreventing(),xa.resolve()},tl.prototype._getActiveElement=function(){return E(this,void 0,void 0,function(){var e;return C(this,function(t){return e=y.domUtils.getActiveElement(),[2,this.replicator.encode(e)]})})},tl.prototype._failIfClientCodeExecutionIsInterrupted=function(){var t=this.contextStorage.getItem(Oa);return!!t&&(this._onReady(new Wo({isCommandResult:!0,executionError:new xt(t.instantiationCallsiteName)})),!0)},tl.prototype.onCustomClientScriptError=function(t,e){var n=e?new re(t,e):new te(t);this.contextStorage.getItem(Ha)||this.contextStorage.setItem(Ha,n)},tl.prototype._addChildWindowDriverLink=function(t){var e=new ca(t.window,t.windowId);this.childWindowDriverLinks.push(e),this._ensureClosedChildWindowWatcher()},tl.prototype._ensureClosedChildWindowWatcher=function(){var e=this;this.checkClosedChildWindowIntervalId||(this.checkClosedChildWindowIntervalId=Ma.setInterval.call(vl,function(){var t=y.arrayUtils.find(e.childWindowDriverLinks,function(t){return t.driverWindow.closed});t&&(e.emit(Qa),y.arrayUtils.remove(e.childWindowDriverLinks,t),t.ignoreMasterSwitching||e._setCurrentWindowAsMaster(),e.childWindowDriverLinks.length||(Ma.clearInterval.call(vl,e.checkClosedChildWindowIntervalId),delete e.checkClosedChildWindowIntervalId))},200))},tl.prototype._setAsMasterInProgressOrCompleted=function(){return this.setAsMasterInProgress||this.role===fa},tl.prototype._setCurrentWindowAsMaster=function(){var t=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,this._clearActiveChildIframeInfo(),xa.resolve().then(function(){return y.browser.setActiveWindowId(t.browserActiveWindowId,s.createNativeXHR,t.windowId)}).then(function(){t._startInternal({finalizePendingCommand:!0,isFirstRequestAfterWindowSwitching:!0}),t.setAsMasterInProgress=!1}).catch(function(){t._onReady(new Wo({isCommandResult:!0,executionError:new Wn}))}))},tl.prototype._onChildWindowOpened=function(t){this._addChildWindowDriverLink(t),this._switchToChildWindow(t.windowId)},tl.prototype._sendStartToRestoreCommand=function(){if(this.contextStorage){this._stopRespondToChildren=!0,this.contextStorage.setItem(ja,this.childWindowDriverLinks.length);for(var t=0,e=this.childWindowDriverLinks;t<e.length;t++)e[t].startToRestore()}},tl.prototype._onFormSubmit=function(t){this.contextStorage&&this.contextStorage.getItem(ka)&&(t.preventSubmit=!0)},tl.prototype._onConsoleMessage=function(t){var e=t.meth,n=t.line,r=this.consoleMessages;r.addMessage(e,n,this.windowId),this.consoleMessages=r},tl.prototype._addPendingErrorToStatus=function(t){var e=this.contextStorage.getItem(Ha);e&&(this.contextStorage.setItem(Ha,null),t.pageError=e)},tl.prototype._addUnexpectedDialogErrorToStatus=function(t){var e=this.nativeDialogsTracker.getUnexpectedDialogError();t.pageError=t.pageError||e},tl.prototype._addConsoleMessagesToStatus=function(t){t.consoleMessages=this.consoleMessages,this.consoleMessages=null},tl.prototype._addPendingWindowSwitchingStateToStatus=function(t){t.isPendingWindowSwitching=this._isPendingSwitchingWindow()},tl.prototype._sendStatusRequest=function(t){function e(){return y.getTimeLimitedPromise(Na.asyncServiceMsg(r),5e3)}function n(){return y.delay(300).then(e)}for(var r={cmd:T.ready,status:t,disableResending:!0,allowRejecting:!0},i=e(),o=0;o<W;o++)i=i.catch(n);return i},tl.prototype._sendStatus=function(t){var e=this;t.resent||(this._addPendingErrorToStatus(t),this._addUnexpectedDialogErrorToStatus(t),this._addConsoleMessagesToStatus(t),this._addPendingWindowSwitchingStateToStatus(t)),this.contextStorage.setItem(La,t);var n=null;return y.pageUnloadBarrier.wait(0).then(function(){return e._sendStatusRequest(t)}).then(function(t){return n=t,y.pageUnloadBarrier.wait(0)}).then(function(){return e.contextStorage.setItem(La,null),n})},tl.prototype._addChildIframeDriverLink=function(t,e){var n,r=this._getChildIframeDriverLinkByWindow(e);r||(n=this.testRunId+"-"+$r(),r=new xo(e,n),this.childIframeDriverLinks.push(r)),r.sendConfirmationMessage(t)},tl.prototype._getTargetWindowNotFoundResult=function(t,e){return xa.resolve({success:!1,errCode:t,errMsg:e})},tl.prototype._getChildWindowValidateResult=function(t){var e=t.find(function(t){return t.result.success});if(e)return e.result;var n=t.find(function(t){return t.result.errCode===pt||t.result.errCode===_t});return(n=n||t.find(function(t){return!!t.result.errCode}))?{errCode:n.result.errCode}:void 0},tl.prototype._handleWindowValidation=function(n,r,i,o){return E(this,void 0,void 0,function(){var e;return C(this,function(t){switch(t.label){case 0:return[4,this._validateWindow(n,r,i,o)];case 1:return e=t.sent(),No({requestMsgId:n.id,window:r,result:e}),[2]}})})},tl.prototype._getWindowInfo=function(){var t=s.utils.url.parseProxyUrl(vl.location.toString());return{id:this.windowId,title:_l.title,url:t.destUrl}},tl.prototype._isTargetWindow=function(t){return t.windowId===this.windowId},tl.prototype._validateWindow=function(r,t,i,o){return E(this,void 0,void 0,function(){var e,n;return C(this,function(t){switch(t.label){case 0:return this._isTargetWindow(r)?[2,i()]:this.childWindowDriverLinks.length?(e=this.childWindowDriverLinks.map(function(t){return t.findChildWindows(r,o)}),[4,xa.all(e)]):[2,this._getTargetWindowNotFoundResult(mt)];case 1:return n=t.sent(),[2,this._getChildWindowValidateResult(n)]}})})},tl._createWindowValidationError=function(t){var e=t.errCode;return new(e===pt?Rn:e===_t?Pn:Hn)},tl.prototype._getCloseWindowFoundResult=function(){return this.parentWindowDriverLink?this.childWindowDriverLinks.length?xa.resolve({success:!1,errCode:pt}):xa.resolve({success:!0}):xa.resolve({success:!1,errCode:_t})},tl.prototype._handleCloseWindowValidation=function(t,e){var n=this;return this._handleWindowValidation(t,e,function(){return n._getCloseWindowFoundResult()},Ei)},tl.prototype._handleSwitchToWindowValidation=function(t,e){return this._handleWindowValidation(t,e,function(){return xa.resolve({success:!0})},Si)},tl.prototype._handleCloseWindow=function(e,n){return E(this,void 0,void 0,function(){return C(this,function(t){switch(t.label){case 0:return[4,this._closeWindow(e,n)];case 1:return t.sent(),No({requestMsgId:e.id,window:n}),[2]}})})},tl.prototype._closeWindowAndWait=function(t,e){var n=this._createWaitForEventPromise(Qa,2e3);return t.ignoreMasterSwitching=!e.isCurrentWindow,t.driverWindow.close(),n},tl.prototype._closeWindow=function(e){if(!this.childWindowDriverLinks.length)return xa.resolve();var t=this.childWindowDriverLinks.find(function(t){return t.windowId===e.windowId});if(t)return this._closeWindowAndWait(t,e);var n=this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,xi)});return xa.all(n)},tl.prototype._getWindows=function(){return E(this,void 0,void 0,function(){var e,n,r,i,o,s;return C(this,function(t){switch(t.label){case 0:return this.childWindowDriverLinks.length?(e=this.childWindowDriverLinks.map(function(t){return t.findChildWindows({},bi)}),[4,xa.all(e)]):[2,[this._getWindowInfo()]];case 1:for(n=t.sent(),r=[this._getWindowInfo()],i=0,o=n;i<o.length;i++)s=o[i],Array.isArray(s.result)&&(r=r.concat(s.result));return[2,r]}})})},tl.prototype._handleGetWindows=function(n,r){return E(this,void 0,void 0,function(){var e;return C(this,function(t){switch(t.label){case 0:return[4,this._getWindows(n,r)];case 1:return e=t.sent(),No({requestMsgId:n.id,window:r,result:e}),[2]}})})},tl.prototype._handleSwitchToWindow=function(e,n){return E(this,void 0,void 0,function(){return C(this,function(t){switch(t.label){case 0:return[4,this._switchToWindow(e)];case 1:return t.sent(),No({requestMsgId:e.id,window:n}),[2]}})})},tl.prototype._switchToWindow=function(e){var t=this;return this._isTargetWindow(e)?xa.resolve().then(function(){t._setCurrentWindowAsMaster()}):this.childWindowDriverLinks.length?xa.all(this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,Mi)})):xa.resolve()},tl.prototype._handleSetAsMasterMessage=function(t,e){var n=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,No({requestMsgId:t.id,window:e}),xa.resolve().then(function(){return y.browser.setActiveWindowId(n.browserActiveWindowId,s.createNativeXHR,n.windowId)}).then(function(){n._startInternal({finalizePendingCommand:t.finalizePendingCommand,result:{id:n.windowId}}),n.setAsMasterInProgress=!1}).catch(function(){n._onReady(new Wo({isCommandResult:!0,executionError:new Wn}))}))},tl.prototype._handleCloseAllWindowsMessage=function(t,e){var n=this;this._closeAllChildWindows().then(function(){No({requestMsgId:t.id,window:e})}).catch(function(){n._onReady(new Wo({isCommandResult:!0,executionError:new An}))})},tl.prototype._handleStartToRestoreChildLinkMessage=function(){this.parentWindowDriverLink.restoreChild(this._getCurrentWindowId())},tl.prototype._handleHasPendingActionFlags=function(t,e){var n=this._hasPendingActionFlags(this.contextStorage);No({requestMsgId:t.id,window:e,result:n})},tl.prototype._handleRestoreChildLink=function(t,e){this._stopRespondToChildren||(this._addChildWindowDriverLink({window:e,windowId:t.windowId}),this.childWindowDriverLinks.length===this.contextStorage.getItem(ja)&&this._restoreChildWindowsPromiseResolver&&(this._restoreChildWindowsPromiseResolver(),delete this._restoreChildWindowsPromiseResolver,this.contextStorage.setItem(ja,0)),No({requestMsgId:t.id,window:e}))},tl.prototype._handleChildWindowIsOpenedInIFrame=function(){var e=this;this._pendingChildWindowInIFrame=new xa(function(t){e._resolvePendingChildWindowInIframe=t})},tl.prototype._handleChildWindowIsLoadedInIFrame=function(e,t){No({requestMsgId:e.id,window:t}),this._resolvePendingChildWindowInIframe(),this.childWindowDriverLinks.find(function(t){return t.windowId===e.windowId})||this._onChildWindowOpened({window:t,windowId:e.windowId})},tl.prototype._handleStopInternalFromFrame=function(t,e){No({requestMsgId:t.id,window:e}),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this._stopInternal()},tl.prototype._initChildDriverListening=function(){var r=this;Ra.on(Ra.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message,n=t.source;switch(e.type){case ti:r._addChildIframeDriverLink(e.id,n);break;case mi:r._handleChildWindowIsOpenedInIFrame(e,n);break;case pi:r._handleChildWindowIsLoadedInIFrame(e,n);break;case gi:r._handleStopInternalFromFrame(e,n);break;case ui:r._handleSetAsMasterMessage(e,n);break;case ei:r._handleSwitchToWindow(e,n);break;case ni:r._handleCloseWindow(e,n);break;case ii:r._handleSwitchToWindowValidation(e,n);break;case ri:r._handleCloseWindowValidation(e,n);break;case oi:r._handleGetWindows(e,n);break;case di:r._handleCloseAllWindowsMessage(e,n);break;case hi:r._handleStartToRestoreChildLinkMessage();break;case wi:r._handleHasPendingActionFlags(e,n);break;case fi:r._handleRestoreChildLink(e,n)}})},tl.prototype._getChildIframeDriverLinkByWindow=function(e){return y.arrayUtils.find(this.childIframeDriverLinks,function(t){return t.driverWindow===e})},tl.prototype._getChildWindowDriverLinkByWindow=function(e){return y.arrayUtils.find(this.childWindowDriverLinks,function(t){return t.driverWindow===e})},tl.prototype._runInActiveIframe=function(t){var e=this,n=xa.resolve(),r=this.contextStorage.getItem(Ba);!this.activeChildIframeDriverLink&&r&&(n=this._switchToIframe(r,Ya)),n.then(function(){return e.contextStorage.setItem(e.EXECUTING_IN_IFRAME_FLAG,!0),e.activeChildIframeDriverLink.executeCommand(t,e.speed)}).then(function(t){return e._onCommandExecutedInIframe(t)}).catch(function(t){return e._onCommandExecutedInIframe(new Wo({isCommandResult:!0,executionError:t}))})},tl.prototype._onCommandExecutedInIframe=function(t){var e=this;this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1);var n=xa.resolve();this._pendingChildWindowInIFrame&&(n=this._pendingChildWindowInIFrame),n.then(function(){e._onReady(t)})},tl.prototype._ensureChildIframeDriverLink=function(t,e,n){var r=this;return y.waitFor(function(){return r._getChildIframeDriverLinkByWindow(t)},500,n).catch(function(){throw new e})},tl.prototype._ensureChildWindowDriverLink=function(t,e,n){var r=this;return y.waitFor(function(){return r._getChildWindowDriverLinkByWindow(t)},500,n).catch(function(){throw new e})},tl.prototype._switchToIframe=function(e,n){var t,r,i,o,s,a,l,c=this,u="number"==typeof e.timeout?e.timeout:this.selectorTimeout;return t=e,r=u,i=null,o=function(t){return new n.NotFoundError(null,t)},s=function(){return new n.IsInvisibleError},a=this.statusBar,l=new ds(t,r,i,o,s),a.showWaitingElementStatus(l.timeout),l.getResult().then(function(t){return a.hideWaitingElementStatus(!!t).then(function(){return t})}).catch(function(t){return a.hideWaitingElementStatus(!1).then(function(){throw t})}).then(function(t){if(!y.domUtils.isIframeElement(t))throw new un;return c._ensureChildIframeDriverLink(Ma.contentWindowGetter.call(t),n.NotLoadedError,u)}).then(function(t){t.availabilityTimeout=u,c.activeChildIframeDriverLink=t,c.contextStorage.setItem(Ba,e)})},tl.prototype._createWaitForEventPromise=function(e,n){var r=this,i=null,t=new xa(function(t){Ma.setTimeout.call(vl,function(){r.off(e,i),t()},n)}),o=new xa(function(t){i=function(){this.off(e,i),t()},r.on(e,i)});return xa.race([t,o])},tl.prototype._waitForCurrentCommandCompletion=function(){return this.contextStorage.getItem(this.COMMAND_EXECUTING_FLAG)?this._createWaitForEventPromise(Ja,Ka):xa.resolve()},tl.prototype._waitForEmptyCommand=function(){return this._createWaitForEventPromise($a,3e4)},tl.prototype._abortSwitchingToChildWindowIfItClosed=function(){if(this.activeChildWindowDriverLink.driverWindow.closed)throw y.arrayUtils.remove(this.childWindowDriverLinks,this.activeChildWindowDriverLink),this.activeChildWindowDriverLink=null,new Kn},tl.prototype._switchToChildWindow=function(t){var e=this;this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0);var n=this.contextStorage.getItem(this.WINDOW_COMMAND_API_CALL_FLAG);return function(e,t){if("string"!=typeof e)return la.resolve(null);var n=y.arrayUtils.find(t,function(t){return t.windowId===e});if(n)return la.resolve(n);var r=new _n;return la.reject(r)}(t,this.childWindowDriverLinks).then(function(t){return e._ensureChildWindowDriverLink(t.driverWindow,Cn,e.childWindowReadyTimeout)}).then(function(t){return e.activeChildWindowDriverLink=t,e._waitForCurrentCommandCompletion()}).then(function(){return n?void 0:e._waitForEmptyCommand()}).then(function(){return e._observeFileDownloadingInNewWindow(),e._abortSwitchingToChildWindowIfItClosed(),e._stopInternal(),e.activeChildWindowDriverLink.setAsMaster(n)}).then(function(){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(t){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1),t instanceof Kn?e._onReady(new Wo):e._onReady(new Wo({isCommandResult:!0,executionError:new Wn}))})},tl.prototype._switchToTopParentWindow=function(){var t=this.parentWindowDriverLink.setTopOpenedWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(t)},tl.prototype._switchToParentWindow=function(t){void 0===t&&(t={});var e=this.parentWindowDriverLink.setParentWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(e,t)},tl.prototype._switchToParentWindowInternal=function(t,e){var n=this;return void 0===e&&(e={}),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0),xa.resolve().then(function(){return n._stopInternal(),t(e)}).then(function(){n.contextStorage.setItem(n.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(){n.contextStorage.setItem(n.PENDING_WINDOW_SWITCHING_FLAG,!1),n._onReady(new Wo({isCommandResult:!0,executionError:new Wn}))})},tl.prototype._switchToMainWindow=function(t){this.activeChildIframeDriverLink&&this.activeChildIframeDriverLink.executeCommand(t),this._clearActiveChildIframeInfo()},tl.prototype._clearActiveChildIframeInfo=function(){this.contextStorage.setItem(Ba,null),this.activeChildIframeDriverLink=null},tl.prototype._setNativeDialogHandlerInIframes=function(t){for(var e=new zi(t),n=0;n<this.childIframeDriverLinks.length;n++)Ra.sendServiceMsg(e,this.childIframeDriverLinks[n].driverWindow)},tl.prototype._onActionCommand=function(t){var o=this,e=new os(t,this.selectorTimeout,this.speed,function(t,e,n){var r=Sa(e.notFound),i=Sa(e.invisible);return new ds(t,o.selectorTimeout,n,r,i).getResult()});e.on(os.EXECUTION_STARTED_EVENT,function(){o.statusBar.hideWaitingElementStatus(!0),o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!0)}),e.on(os.WAITING_FOR_ELEMENT_EVENT,function(t){o.statusBar.showWaitingElementStatus(t)});var n=new y.ClientRequestEmitter,r=new y.ScriptExecutionEmitter,i=new Ca(n,r,y.pageUnloadBarrier);e.execute(i).then(function(t){return new Wo({isCommandResult:!0,result:Cr(new ma).encode(t)})}).catch(function(t){return o.statusBar.hideWaitingElementStatus(!1).then(function(){return new Wo({isCommandResult:!0,executionError:t})})}).then(function(t){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!1),o._onReady(t)})},tl.prototype._onSetNativeDialogHandlerCommand=function(t){this.nativeDialogsTracker.setHandler(t.dialogHandler),this._setNativeDialogHandlerInIframes(t.dialogHandler),this._onReady(new Wo({isCommandResult:!0}))},tl.prototype._onGetNativeDialogHistoryCommand=function(){this._onReady(new Wo({isCommandResult:!0,result:this.nativeDialogsTracker.appearedDialogs}))},tl.prototype._onGetBrowserConsoleMessagesCommand=function(){this._onReady(new Wo({isCommandResult:!0}))},tl.prototype._onNavigateToCommand=function(t){var e=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),function(i){return E(this,void 0,void 0,function(){var e,n,r;return C(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=new y.ClientRequestEmitter,n=new y.RequestBarrier(e),u.navigateTo(i.url,i.forceReload),[4,u.Promise.all([n.wait(),y.pageUnloadBarrier.wait()])];case 1:return t.sent(),[2,new Wo({isCommandResult:!0})];case 2:return r=t.sent(),[2,new Wo({isCommandResult:!0,executionError:r})];case 3:return[2]}})})}(t).then(function(t){return e.contextStorage.setItem(e.COMMAND_EXECUTING_FLAG,!1),e._onReady(t)})},tl.prototype._onExecuteClientFunctionCommand=function(t){var e=this;this.contextStorage.setItem(Oa,{instantiationCallsiteName:t.instantiationCallsiteName}),aa(new Lr(t)).then(function(t){e.contextStorage.setItem(Oa,null),e._onReady(t)})},tl.prototype._onExecuteSelectorCommand=function(t){var e,n,r,i,o,s,a,l=this,c=this.contextStorage.getItem(Ua)||new Pa,u=t.needError?function(t){return new Gt(null,t)}:null;e=t,n=this.selectorTimeout,r=c,o=i=u,s=this.statusBar,a=new ds(e,n,r,i,o),s.showWaitingElementStatus(a.timeout),aa(a).then(function(t){return s.hideWaitingElementStatus(!!t.result).then(function(){return t})}).then(function(t){l.contextStorage.setItem(Ua,null),l._onReady(t)})},tl.prototype._onSwitchToMainWindowCommand=function(t){this._switchToMainWindow(t),this._onReady(new Wo({isCommandResult:!0}))},tl.prototype._onSwitchToIframeCommand=function(t){var e=this;this._switchToIframe(t.selector,Xa).then(function(){return e._onReady(new Wo({isCommandResult:!0}))}).catch(function(t){return e._onReady(new Wo({isCommandResult:!0,executionError:t}))})},tl.prototype._onWindowOpenCommand=function(t){this.contextStorage.setItem(this.WINDOW_COMMAND_API_CALL_FLAG,!0),vl.open(t.url)},tl.prototype._onWindowCloseCommand=function(a){return E(this,void 0,void 0,function(){var e,n,r,i,o,s;return C(this,function(t){switch(t.label){case 0:e=this._getTopOpenedWindow(),n=a.windowId||this.windowId,r=n===this.windowId,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,this._validateChildWindowCloseCommandExists(n,e)];case 2:if(i=t.sent(),!(o=i.result).success)throw tl._createWindowValidationError(o);return[4,bo(new xi({windowId:n,isCurrentWindow:r}),e,Ao,Wn)];case 3:return t.sent(),r||this._onReady(new Wo({isCommandResult:!0})),[3,5];case 4:return s=t.sent(),this._onReady(new Wo({isCommandResult:!0,executionError:s})),[3,5];case 5:return[2]}})})},tl.prototype._onGetCurrentWindowCommand=function(){this._onReady(new Wo({isCommandResult:!0,result:{id:this.windowId}}))},tl.prototype._onGetWindowsCommand=function(){return E(this,void 0,void 0,function(){var e,n;return C(this,function(t){switch(t.label){case 0:return e=this._getTopOpenedWindow(),[4,bo(new bi,e,Ao,Wn)];case 1:return n=t.sent(),this._onReady(new Wo({isCommandResult:!0,result:n.result})),[2]}})})},tl.prototype._validateChildWindowCloseCommandExists=function(t,e){return bo(new Ei({windowId:t}),e,Ao,Wn)},tl.prototype._validateChildWindowSwitchToWindowCommandExists=function(t,e){var n=t.windowId,r=t.fn;return bo(new Si({windowId:n,fn:r}),e,Ao,Wn)},tl.prototype._getTopOpenedWindow=function(){var t;return((null===(t=this.parentWindowDriverLink)||void 0===t?void 0:t.getTopOpenedWindow())||vl).top},tl.prototype._onSwitchToWindow=function(i,o){return E(this,void 0,void 0,function(){var e,n,r;return C(this,function(t){switch(t.label){case 0:return e=this._getTopOpenedWindow(),[4,this._validateChildWindowSwitchToWindowCommandExists({windowId:i.windowId,fn:i.checkWindow},e)];case 1:return n=t.sent(),(r=n.result).success?(this._stopInternal(),bo(new Mi({windowId:i.windowId,fn:i.checkWindow}),e,Ao,Wn)):this._onReady(new Wo({isCommandResult:!0,executionError:o||tl._createWindowValidationError(r)})),[2]}})})},tl.prototype._restoreChildWindowLinks=function(){return E(this,void 0,void 0,function(){var e,n=this;return C(this,function(t){switch(t.label){case 0:if(!this.contextStorage.getItem(ja))return[2];e=new xa(function(t){n._restoreChildWindowsPromiseResolver=t}),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,y.getTimeLimitedPromise(e,3e4)];case 2:return t.sent(),[3,4];case 3:return t.sent(),this._onReady(new Wo({isCommandResult:!0,executionError:new Qn})),[3,4];case 4:return[2]}})})},tl.prototype._onSwitchToPreviousWindow=function(t){this._onSwitchToWindow(t,new jn)},tl.prototype._onSwitchToParentWindow=function(){this.parentWindowDriverLink?this._switchToParentWindow({finalizePendingCommand:!0}):this._onReady(new Wo({isCommandResult:!0,executionError:new Vn}))},tl.prototype._onBrowserManipulationCommand=function(t){var e,n,r,i=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),e=t,n=this.selectorTimeout,r=this.statusBar,new oa(e,n,r).execute().then(function(t){return i.contextStorage.setItem(i.COMMAND_EXECUTING_FLAG,!1),i._onReady(t)})},tl.prototype._onSetBreakpointCommand=function(t){var n=this,e=t.isTestError,r=t.inCompilerService,i=this.statusBar.showDebuggingStatus(e);r?(i.then(function(t){n.debug=t}),this._onReady(new Wo({isCommandResult:!0,result:!0}))):i.then(function(t){var e=t===Tt;n._onReady(new Wo({isCommandResult:!0,result:e}))})},tl.prototype._onDisableDebugCommand=function(){this.statusBar._resetState(),this._onReady(new Wo({isCommandResult:!0}))},tl.prototype._onSetTestSpeedCommand=function(t){this.speed=t.speed,this._onReady(new Wo({isCommandResult:!0}))},tl.prototype._onShowAssertionRetriesStatusCommand=function(t){this.contextStorage.setItem(Va,t.timeout),this.contextStorage.setItem(qa,Ma.dateNow()),this.statusBar.showWaitingAssertionRetriesStatus(t.timeout),this._onReady(new Wo({isCommandResult:!0}))},tl.prototype._onHideAssertionRetriesStatusCommand=function(t){var e=this;this.contextStorage.setItem(Va,null),this.contextStorage.setItem(qa,null),this.statusBar.hideWaitingAssertionRetriesStatus(t.success).then(function(){return e._onReady(new Wo({isCommandResult:!0}))})},tl.prototype._checkStatus=function(){var r=this;return y.browser.checkStatus(this.browserStatusDoneUrl,s.createNativeXHR,{manualRedirect:!0}).then(function(t){var e=t.command,n=t.redirecting;n&&e.url.indexOf(r.testRunId)<0?(Da.clear(),Da.lock()):r.contextStorage.setItem(ka,!1),n?y.browser.redirect(e):r._onReady({isCommandResult:!1})}).catch(function(){return y.delay(1e3)})},tl.prototype._onCustomCommand=function(t){var e=this;(0,this.customCommandHandlers[t.type].handler)(t).then(function(t){e._onReady(new Wo({isCommandResult:!0,result:t}))})},tl.prototype._closeAllChildWindows=function(){var t=this;return this.childWindowDriverLinks.length?xa.all(this.childWindowDriverLinks.map(function(t){return t.closeAllChildWindows()})).then(function(){Ma.arrayForEach.call(t.childWindowDriverLinks,function(t){t.driverWindow.close()})}):xa.resolve()},tl.prototype._onTestDone=function(t){var e=this;this.contextStorage.setItem(ka,!0),this.parentWindowDriverLink?this._switchToTopParentWindow():this._closeAllChildWindows().then(function(){return e._sendStatus(t)}).then(function(){e._checkStatus()}).catch(function(){e._onReady(new Wo({isCommandResult:!0,executionError:An}))})},tl.prototype._onBackupStoragesCommand=function(){this._onReady(new Wo({isCommandResult:!0,result:Da.backup()}))},tl.prototype._isPendingSwitchingWindow=function(){return!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},tl.prototype._onPrepareClientEnvironmentInDebugMode=function(t){Ma.objectDefineProperty(vl,t.esmRuntime,{value:{g:vl,c:vl.eval},configurable:!0}),this._onReady(new Wo({isCommandResult:!0,result:!0}))},tl.prototype._isStatusWithCommandResultInPendingWindowSwitchingMode=function(t){return t.isCommandResult&&this._isPendingSwitchingWindow()},tl.prototype._isEmptyCommandInPendingWindowSwitchingMode=function(t){return!t&&this._isPendingSwitchingWindow()},tl.prototype._observeFileDownloadingInNewWindow=function(){var e=this,t=new Wo({isObservingFileDownloadingInNewWindow:!0});this._isPendingSwitchingWindow()&&this._sendStatus(t).then(function(t){t?e._onCommand(t):e._observeFileDownloadingInNewWindow()})},tl.prototype._onReady=function(t){var e=this;this.debug&&(t.debug=this.debug,this.debug=null),this._isStatusWithCommandResultInPendingWindowSwitchingMode(t)&&this.emit(Ja),this._sendStatus(t).then(function(t){if(t)e._onCommand(t);else{if(e._isEmptyCommandInPendingWindowSwitchingMode(t))return void e.emit($a);e._onReady(new Wo)}})},tl.prototype._executeCommand=function(t){this.contextStorage.setItem(this.WINDOW_COMMAND_API_CALL_FLAG,!1),this.customCommandHandlers[t.type]?this._onCustomCommand(t):t.type===b.testDone?this._onTestDone(new Wo({isCommandResult:!0})):t.type===b.setBreakpoint?this._onSetBreakpointCommand(t):t.type===b.disableDebug?this._onDisableDebugCommand():t.type===b.switchToMainWindow?this._onSwitchToMainWindowCommand(t):t.type===b.switchToIframe?this._onSwitchToIframeCommand(t):t.type===b.openWindow?this._onWindowOpenCommand(t):t.type===b.closeWindow?this._onWindowCloseCommand(t):t.type===b.getCurrentWindow?this._onGetCurrentWindowCommand(t):t.type===b.getCurrentWindows?this._onGetWindowsCommand():t.type===b.switchToWindow?this._onSwitchToWindow(t):t.type===b.switchToPreviousWindow?this._onSwitchToPreviousWindow(t):t.type===b.switchToParentWindow?this._onSwitchToParentWindow():It(t)?this._onBrowserManipulationCommand(t):t.type===b.executeClientFunction?this._onExecuteClientFunctionCommand(t):t.type===b.executeSelector?this._onExecuteSelectorCommand(t):t.type===b.navigateTo?this._onNavigateToCommand(t):t.type===b.setNativeDialogHandler?this._onSetNativeDialogHandlerCommand(t):t.type===b.getNativeDialogHistory?this._onGetNativeDialogHistoryCommand(t):t.type===b.getBrowserConsoleMessages?this._onGetBrowserConsoleMessagesCommand(t):t.type===b.setTestSpeed?this._onSetTestSpeedCommand(t):t.type===b.showAssertionRetriesStatus?this._onShowAssertionRetriesStatusCommand(t):t.type===b.hideAssertionRetriesStatus?this._onHideAssertionRetriesStatusCommand(t):t.type===b.backupStorages?this._onBackupStoragesCommand():t.type===b.closeChildWindowOnFileDownloading?this._closeChildWindowOnFileDownloading():t.type===b.prepareClientEnvironmentInDebugMode?this._onPrepareClientEnvironmentInDebugMode(t):this._onActionCommand(t)},tl.prototype._closeChildWindowOnFileDownloading=function(){this.activeChildWindowDriverLink.closeFileDownloadingWindow(),y.arrayUtils.remove(this.childWindowDriverLinks,this.activeChildWindowDriverLink),_.cursor.show(),this._startInternal()},tl.prototype._isExecutableInTopWindowOnly=function(t){if((e=t).type===b.testDone||e.type===b.switchToMainWindow||e.type===b.setNativeDialogHandler||e.type===b.getNativeDialogHistory||e.type===b.setTestSpeed||e.type===b.showAssertionRetriesStatus||e.type===b.hideAssertionRetriesStatus||e.type===b.setBreakpoint||It(e)&&e.type!==b.takeElementScreenshot)return!0;var e,n=this.customCommandHandlers[t.type];return t.forceExecutionInTopWindowOnly||n&&n.isExecutableInTopWindowOnly},tl.prototype._onCommand=function(n){var r=this;this.readyPromise.then(function(){var t,e=Et(n);r.contextStorage.getItem(Ha)&&e?r._onReady(new Wo({isCommandResult:!0})):(t=r.activeChildIframeDriverLink||r.contextStorage.getItem(Ba),r._isExecutableInTopWindowOnly(n)||!t?r._executeCommand(n):r._runInActiveIframe(n))})},tl.prototype.setCustomCommandHandlers=function(t,e,n){this.customCommandHandlers[t]={isExecutableInTopWindowOnly:n,handler:e}},tl.prototype._startInternal=function(t){this.role=fa,y.browser.startHeartbeat(this.heartbeatUrl,s.createNativeXHR),this._setupAssertionRetryIndication(),this._startCommandsProcessing(t)},tl.prototype._stopInternal=function(){this.role=pa,y.browser.stopHeartbeat(),_.cursor.hide()},tl.prototype._setupAssertionRetryIndication=function(){var n=this;this.readyPromise.then(function(){n.statusBar.hidePageLoadingStatus();var t,e=n.contextStorage.getItem(Va);e&&(t=n.contextStorage.getItem(qa),0<e-(new Pa-t)&&n.statusBar.showWaitingAssertionRetriesStatus(e,t))})},tl.prototype._startCommandsProcessing=function(t){void 0===t&&(t={finalizePendingCommand:!1,isFirstRequestAfterWindowSwitching:!1,result:void 0});var e,n,r=this.contextStorage.getItem(La);r&&(r.resent=!0),this.contextStorage.getItem(ka)?r?this._onTestDone(r):this._checkStatus():this._failIfClientCodeExecutionIsInterrupted()||(e=t.finalizePendingCommand||this._hasPendingActionFlags(this.contextStorage),n=r||new Wo({isCommandResult:e,isFirstRequestAfterWindowSwitching:t.isFirstRequestAfterWindowSwitching,result:t.result}),this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!1),this._onReady(n))},tl.prototype._initParentWindowLink=function(){vl.opener&&vl.opener!==vl&&this.windowId&&(this.parentWindowDriverLink=new da(vl))},tl.prototype._initConsoleMessages=function(){var t=this.consoleMessages;t.ensureMessageContainer(this.windowId),this.consoleMessages=t},tl.prototype._getDriverRole=function(){return E(this,void 0,void 0,function(){return C(this,function(t){switch(t.label){case 0:return this.windowId?[4,y.browser.getActiveWindowId(this.browserActiveWindowId,s.createNativeXHR)]:[2,fa];case 1:return[2,t.sent().activeWindowId===this.windowId?fa:pa]}})})},tl.prototype._init=function(){this.contextStorage=new yo(vl,this.testRunId,this.windowId),this.nativeDialogsTracker=new Kr(this.contextStorage,this.dialogHandler),this.statusBar=new e.StatusBar(this.userAgent,this.fixtureName,this.testName,this.contextStorage),this.statusBar.on(this.statusBar.UNLOCK_PAGE_BTN_CLICK,y.disableRealEventsPreventing),this.speed=this.initialSpeed,this._initConsoleMessages(),this._initParentWindowLink(),this._isOpenedInIframe()&&bo(new so(this.windowId),vl.opener.top,Ao,Hn)},tl.prototype._doFirstPageLoadSetup=function(){return E(this,void 0,void 0,function(){return C(this,function(t){return this.isFirstPageLoad&&this.canUseDefaultWindowActions,[2]})})},tl.prototype.start=function(){return E(this,void 0,void 0,function(){var e;return C(this,function(t){switch(t.label){case 0:return this._init(),[4,this._doFirstPageLoadSetup()];case 1:return t.sent(),[4,this._restoreChildWindowLinks()];case 2:return t.sent(),[4,this._getDriverRole()];case 3:return e=t.sent(),this.role===fa||e===fa&&this._startInternal(),[2]}})})},tl);function tl(t,e,n,r){var i=ba.call(this)||this;i.COMMAND_EXECUTING_FLAG="testcafe|driver|command-executing-flag",i.EXECUTING_IN_IFRAME_FLAG="testcafe|driver|executing-in-iframe-flag",i.PENDING_WINDOW_SWITCHING_FLAG="testcafe|driver|pending-window-switching-flag",i.WINDOW_COMMAND_API_CALL_FLAG="testcafe|driver|window-command-api-flag",i.testRunId=t,i.heartbeatUrl=e.heartbeat,i.browserStatusUrl=e.status,i.browserStatusDoneUrl=e.statusDone,i.browserActiveWindowId=e.activeWindowId,i.userAgent=n.userAgent,i.fixtureName=n.fixtureName,i.testName=n.testName,i.selectorTimeout=r.selectorTimeout,i.pageLoadTimeout=r.pageLoadTimeout,i.childWindowReadyTimeout=r.childWindowReadyTimeout,i.initialSpeed=r.speed,i.skipJsErrors=r.skipJsErrors,i.dialogHandler=r.dialogHandler,i.canUseDefaultWindowActions=r.canUseDefaultWindowActions,i.isFirstPageLoad=Aa.get().isFirstPageLoad,i.customCommandHandlers={},i.contextStorage=null,i.nativeDialogsTracker=null,i.childIframeDriverLinks=[],i.activeChildIframeDriverLink=null,i.childWindowDriverLinks=[],i.parentWindowDriverLink=null,i.statusBar=null,i.windowId=i._getCurrentWindowId(),i.role=pa,i.setAsMasterInProgress=!1,i.checkClosedChildWindowIntervalId=null;var o=new y.ClientRequestEmitter;return i.pageInitialRequestBarrier=new y.RequestBarrier(o),i.readyPromise=i._getReadyPromise(),i._initChildDriverListening(),y.pageUnloadBarrier.init(),y.preventRealEvents(),s.on(s.EVENTS.uncaughtJsError,function(t){return i._onJsError(t)}),s.on(s.EVENTS.unhandledRejection,function(t){return i._onJsError(t)}),s.on(s.EVENTS.consoleMethCalled,function(t){return i._onConsoleMessage(t)}),s.on(s.EVENTS.beforeFormSubmit,function(t){return i._onFormSubmit(t)}),s.on(s.EVENTS.windowOpened,function(t){return i._onChildWindowOpened(t)}),i.setCustomCommandHandlers(b.unlockPage,function(){return i._unlockPageAfterTestIsDone()}),i.setCustomCommandHandlers(b.getActiveElement,function(){return i._getActiveElement()}),Fa.addInternalEventBeforeListener(vl,["beforeunload"],function(){i._sendStartToRestoreCommand()}),i.replicator=Cr([new Yo]),i}var el=(nl.prototype.establishConnection=function(){return bo(new vi,this.driverWindow,5e3,gn).then(function(t){return t.result.id})},nl.prototype.sendConfirmationMessage=function(t){No({requestMsgId:t,window:this.driverWindow})},nl.prototype.onCommandExecuted=function(t){var e=new ki(t);u.eventSandbox.message.sendServiceMsg(e,this.driverWindow)},nl.prototype.hasPendingActionFlags=function(){return E(this,void 0,void 0,function(){return C(this,function(t){switch(t.label){case 0:return[4,bo(new go,this.driverWindow,5e3,gn)];case 1:return[2,t.sent().result]}})})},nl);function nl(t){this.driverWindow=t}var rl,il=s.eventSandbox.message,ol=(v(sl,rl=Kr),sl.prototype._defaultDialogHandler=function(t){il.sendServiceMsg({type:Hr,dialogType:t,url:Kr._getPageUrl()},vl.top)},sl.prototype._addAppearedDialogs=function(t,e){il.sendServiceMsg({type:Ur,dialogType:t,text:e,url:Kr._getPageUrl()},vl.top)},sl.prototype._onHandlerError=function(t,e){il.sendServiceMsg({type:Br,dialogType:t,message:e,url:Kr._getPageUrl()},vl.top)},sl);function sl(t){return rl.call(this,null,t)||this}var al,ll=u.eventSandbox.message,cl=(v(ul,al=Za),ul.prototype._onJsError=function(){},ul.prototype._onConsoleMessage=function(){},ul.prototype._onChildWindowOpened=function(){ll.sendServiceMsg(new co,vl.top)},ul.prototype._stopInternal=function(){ll.sendServiceMsg(new fo,vl.top)},ul.prototype._initParentDriverListening=function(){var n=this;u.eventSandbox.message.on(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message;y.pageUnloadBarrier.wait(0).then(function(){if(e.type===ai){if(n.lastParentDriverMessageId===e.id)return;n.lastParentDriverMessageId=e.id,n.readyPromise.then(function(){n.speed=e.testSpeed,n.parentDriverLink.sendConfirmationMessage(e.id),n._onCommand(e.command)})}e.type===ci&&(n.nativeDialogsTracker.setHandler(e.dialogHandler),n._setNativeDialogHandlerInIframes(e.dialogHandler))})})},ul.prototype._onSwitchToMainWindowCommand=function(t){this._switchToMainWindow(t)},ul.prototype._onReady=function(t){this.parentDriverLink.onCommandExecuted(t)},ul.prototype._isInCommandExecution=function(){return E(this,void 0,void 0,function(){return C(this,function(t){switch(t.label){case 0:return u.utils.dom.isCrossDomainWindows(vl,vl.parent)?[4,this.parentDriverLink.hasPendingActionFlags()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,this._hasPendingActionFlags(this.contextStorage)]}})})},ul.prototype._init=function(){return E(this,void 0,void 0,function(){var e;return C(this,function(t){switch(t.label){case 0:return[4,this.parentDriverLink.establishConnection()];case 1:return e=t.sent(),this.contextStorage=new yo(vl,e,this.windowId),this._failIfClientCodeExecutionIsInterrupted()?[2]:[4,this._isInCommandExecution()];case 2:return t.sent()&&(this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this._onReady(new Wo({isCommandResult:!0}))),[2]}})})},ul.prototype.start=function(){this.nativeDialogsTracker=new ol(this.dialogHandler),this.statusBar=new e.IframeStatusBar;var t=this._init();this.readyPromise=u.Promise.all([this.readyPromise,t])},ul);function ul(t,e){var n=al.call(this,t,{},{},e)||this;return n.lastParentDriverMessageId=null,n.parentDriverLink=new el(vl.parent),n._initParentDriverListening(),n}var dl={NodeSnapshot:Uo,ElementSnapshot:jo,SelectorExecutor:ds},hl="%testCafeDriver%",fl="%testCafeIframeDriver%",pl="%testCafeEmbeddingUtils%";!function(t){if(t.nativeMethods.objectAssign)t.nativeMethods.objectAssign(Sr,t);else for(var e=0,n=t.nativeMethods.objectKeys(t);e<n.length;e++){var r=n[e];Sr[r]=t[r]}}({isProxyless:!1,nativeMethods:u.nativeMethods,PromiseCtor:u.Promise,delay:y.delay,isShadowRoot:y.domUtils.isShadowRoot,isDomElement:y.domUtils.isDomElement,isTextNode:y.domUtils.isTextNode,isOptionElement:y.domUtils.isOptionElement,getTagName:y.domUtils.getTagName,isOptionElementVisible:e.selectElement.isOptionElementVisible,isElementVisible:y.positionUtils.isElementVisible,getActiveElement:y.domUtils.getActiveElement});var ml=s.nativeMethods,gl=s.EVENTS.evalIframeScript;ml.objectDefineProperty(vl,hl,{configurable:!0,value:Za}),ml.objectDefineProperty(vl,fl,{configurable:!0,value:cl}),ml.objectDefineProperty(vl,pl,{configurable:!0,value:dl}),s.on(gl,function(t){return wl(ml.contentWindowGetter.call(t.iframe))})}(vl["%hammerhead%"],vl["%testCafeAutomation%"],vl["%testCafeCore%"],vl["%hammerhead%"].Promise,vl["%testCafeUI%"])}(window);