"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.calcRelativePosition = exports.getElementFromPoint = exports.getClientDimensions = void 0;
const index_1 = __importDefault(require("./adapter/index"));
const boundary_values_1 = __importDefault(require("../../../../shared/utils/values/boundary-values"));
const dimensions_1 = __importDefault(require("../../../../shared/utils/values/dimensions"));
const axis_values_1 = __importDefault(require("../../../../shared/utils/values/axis-values"));
function getClientDimensions(target) {
    const isHtmlElement = index_1.default.dom.isHtmlElement(target);
    const body = isHtmlElement ? target.getElementsByTagName('body')[0] : null;
    const elementRect = target.getBoundingClientRect();
    const elBorders = boundary_values_1.default.create(index_1.default.style.getBordersWidth(target));
    const elScroll = index_1.default.style.getElementScroll(target);
    const isElementInIframe = index_1.default.dom.isElementInIframe(target);
    const isCompatMode = target.ownerDocument.compatMode === 'BackCompat';
    const elPosition = isHtmlElement ? new axis_values_1.default(0, 0) : axis_values_1.default.create(elementRect);
    let elHeight = elementRect.height;
    let elWidth = elementRect.width;
    if (isHtmlElement) {
        if (body && isCompatMode) {
            elHeight = body.clientHeight;
            elWidth = body.clientWidth;
        }
        else {
            elHeight = target.clientHeight;
            elWidth = target.clientWidth;
        }
    }
    if (isElementInIframe) {
        const iframeElement = index_1.default.dom.getIframeByElement(target);
        if (iframeElement) {
            const iframeOffset = index_1.default.position.getOffsetPosition(iframeElement);
            const clientOffset = index_1.default.position.offsetToClientCoords(axis_values_1.default.create(iframeOffset));
            const iframeBorders = index_1.default.style.getBordersWidth(iframeElement);
            elPosition.add(clientOffset).add(axis_values_1.default.create(iframeBorders));
            if (isHtmlElement)
                elBorders.add(iframeBorders);
        }
    }
    const hasRightScrollbar = !isHtmlElement && index_1.default.style.getInnerWidth(target) !== target.clientWidth;
    const hasBottomScrollbar = !isHtmlElement && index_1.default.style.getInnerHeight(target) !== target.clientHeight;
    const scrollbar = {
        right: hasRightScrollbar ? index_1.default.dom.getScrollbarSize() : 0,
        bottom: hasBottomScrollbar ? index_1.default.dom.getScrollbarSize() : 0,
    };
    return new dimensions_1.default(elWidth, elHeight, elPosition, elBorders, elScroll, scrollbar);
}
exports.getClientDimensions = getClientDimensions;
function getElementFromPoint(x, y) {
    // @ts-ignore
    const ieFn = document.getElementFromPoint;
    const func = ieFn || document.elementFromPoint;
    let el = null;
    try {
        // Permission denied to access property 'getElementFromPoint' error in iframe
        el = func.call(document, x, y);
    }
    catch (_a) {
        return null;
    }
    //NOTE: elementFromPoint returns null when is's a border of an iframe
    if (el === null)
        el = func.call(document, x - 1, y - 1);
    while (el && el.shadowRoot && el.shadowRoot.elementFromPoint) {
        const shadowEl = el.shadowRoot.elementFromPoint(x, y);
        if (!shadowEl || el === shadowEl)
            break;
        el = shadowEl;
    }
    return el;
}
exports.getElementFromPoint = getElementFromPoint;
function calcRelativePosition(dimensions, toDimensions) {
    const pos = boundary_values_1.default.create({
        top: dimensions.top - toDimensions.top,
        left: dimensions.left - toDimensions.left,
        right: toDimensions.right - dimensions.right,
        bottom: toDimensions.bottom - dimensions.bottom,
    });
    return pos.sub(toDimensions.border).sub(toDimensions.scrollbar).round(Math.ceil, Math.floor);
}
exports.calcRelativePosition = calcRelativePosition;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvY2xpZW50L2NvcmUvdXRpbHMvc2hhcmVkL3Bvc2l0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDREQUFzQztBQUN0QyxzR0FBcUc7QUFDckcsNEZBQW9FO0FBQ3BFLDhGQUFxRTtBQUVyRSxTQUFnQixtQkFBbUIsQ0FBRSxNQUFlO0lBQ2hELE1BQU0sYUFBYSxHQUFPLGVBQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVELE1BQU0sSUFBSSxHQUFnQixhQUFhLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ3hGLE1BQU0sV0FBVyxHQUFTLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQ3pELE1BQU0sU0FBUyxHQUFXLHlCQUFjLENBQUMsTUFBTSxDQUFDLGVBQU8sQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDdkYsTUFBTSxRQUFRLEdBQVksZUFBTyxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqRSxNQUFNLGlCQUFpQixHQUFHLGVBQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDaEUsTUFBTSxZQUFZLEdBQVEsTUFBTSxDQUFDLGFBQWEsQ0FBQyxVQUFVLEtBQUssWUFBWSxDQUFDO0lBQzNFLE1BQU0sVUFBVSxHQUFVLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxxQkFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMscUJBQVUsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFaEcsSUFBSSxRQUFRLEdBQUssV0FB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QUMsZ0JBQWdCLEVBQUU7UUFDMUQsTUFBTSxRQUFRLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFdEQsSUFBSSxDQUFDLFFBQVEsSUFBSSxFQUFFLEtBQUssUUFBUTtZQUM1QixNQUFNO1FBRVYsRUFBRSxHQUFHLFFBQVEsQ0FBQztLQUNqQjtJQUVELE9BQU8sRUFBRSxDQUFDO0FBQ2QsQ0FBQztBQTdCRCxrREE2QkM7QUFFRCxTQUFnQixvQkFBb0IsQ0FBRSxVQUFzQixFQUFFLFlBQXdCO0lBQ2xGLE1BQU0sR0FBRyxHQUFHLHlCQUFjLENBQUMsTUFBTSxDQUFDO1FBQzlCLEdBQUcsRUFBSyxVQUFVLENBQUMsR0FBRyxHQUFHLFlBQVksQ0FBQyxHQUFHO1FBQ3pDLElBQUksRUFBSSxVQUFVLENBQUMsSUFBSSxHQUFHLFlBQVksQ0FBQyxJQUFJO1FBQzNDLEtBQUssRUFBRyxZQUFZLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQyxLQUFLO1FBQzdDLE1BQU0sRUFBRSxZQUFZLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNO0tBQ2xELENBQUMsQ0FBQztJQUVILE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDakcsQ0FBQztBQVRELG9EQVNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVyL2luZGV4JztcbmltcG9ydCBCb3VuZGFyeVZhbHVlcywgeyBCb3VuZGFyeVZhbHVlc0RhdGEgfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvdXRpbHMvdmFsdWVzL2JvdW5kYXJ5LXZhbHVlcyc7XG5pbXBvcnQgRGltZW5zaW9ucyBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvdXRpbHMvdmFsdWVzL2RpbWVuc2lvbnMnO1xuaW1wb3J0IEF4aXNWYWx1ZXMgZnJvbSAnLi4vLi4vLi4vLi4vc2hhcmVkL3V0aWxzL3ZhbHVlcy9heGlzLXZhbHVlcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDbGllbnREaW1lbnNpb25zICh0YXJnZXQ6IEVsZW1lbnQpOiBEaW1lbnNpb25zIHtcbiAgICBjb25zdCBpc0h0bWxFbGVtZW50ICAgICA9IGFkYXB0ZXIuZG9tLmlzSHRtbEVsZW1lbnQodGFyZ2V0KTtcbiAgICBjb25zdCBib2R5ICAgICAgICAgICAgICA9IGlzSHRtbEVsZW1lbnQgPyB0YXJnZXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXSA6IG51bGw7XG4gICAgY29uc3QgZWxlbWVudFJlY3QgICAgICAgPSB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgZWxCb3JkZXJzICAgICAgICAgPSBCb3VuZGFyeVZhbHVlcy5jcmVhdGUoYWRhcHRlci5zdHlsZS5nZXRCb3JkZXJzV2lkdGgodGFyZ2V0KSk7XG4gICAgY29uc3QgZWxTY3JvbGwgICAgICAgICAgPSBhZGFwdGVyLnN0eWxlLmdldEVsZW1lbnRTY3JvbGwodGFyZ2V0KTtcbiAgICBjb25zdCBpc0VsZW1lbnRJbklmcmFtZSA9IGFkYXB0ZXIuZG9tLmlzRWxlbWVudEluSWZyYW1lKHRhcmdldCk7XG4gICAgY29uc3QgaXNDb21wYXRNb2RlICAgICAgPSB0YXJnZXQub3duZXJEb2N1bWVudC5jb21wYXRNb2RlID09PSAnQmFja0NvbXBhdCc7XG4gICAgY29uc3QgZWxQb3NpdGlvbiAgICAgICAgPSBpc0h0bWxFbGVtZW50ID8gbmV3IEF4aXNWYWx1ZXMoMCwgMCkgOiBBeGlzVmFsdWVzLmNyZWF0ZShlbGVtZW50UmVjdCk7XG5cbiAgICBsZXQgZWxIZWlnaHQgICA9IGVsZW1lbnRSZWN0LmhlaWdodDtcbiAgICBsZXQgZWxXaWR0aCAgICA9IGVsZW1lbnRSZWN0LndpZHRoO1xuXG4gICAgaWYgKGlzSHRtbEVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGJvZHkgJiYgaXNDb21wYXRNb2RlKSB7XG4gICAgICAgICAgICBlbEhlaWdodCA9IGJvZHkuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgZWxXaWR0aCAgPSBib2R5LmNsaWVudFdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZWxIZWlnaHQgPSB0YXJnZXQuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgZWxXaWR0aCAgPSB0YXJnZXQuY2xpZW50V2lkdGg7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoaXNFbGVtZW50SW5JZnJhbWUpIHtcbiAgICAgICAgY29uc3QgaWZyYW1lRWxlbWVudCA9IGFkYXB0ZXIuZG9tLmdldElmcmFtZUJ5RWxlbWVudCh0YXJnZXQpO1xuXG4gICAgICAgIGlmIChpZnJhbWVFbGVtZW50KSB7XG4gICAgICAgICAgICBjb25zdCBpZnJhbWVPZmZzZXQgID0gYWRhcHRlci5wb3NpdGlvbi5nZXRPZmZzZXRQb3NpdGlvbihpZnJhbWVFbGVtZW50KTtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudE9mZnNldCAgPSBhZGFwdGVyLnBvc2l0aW9uLm9mZnNldFRvQ2xpZW50Q29vcmRzKEF4aXNWYWx1ZXMuY3JlYXRlKGlmcmFtZU9mZnNldCkpO1xuICAgICAgICAgICAgY29uc3QgaWZyYW1lQm9yZGVycyA9IGFkYXB0ZXIuc3R5bGUuZ2V0Qm9yZGVyc1dpZHRoKGlmcmFtZUVsZW1lbnQpO1xuXG4gICAgICAgICAgICBlbFBvc2l0aW9uLmFkZChjbGllbnRPZmZzZXQpLmFkZChBeGlzVmFsdWVzLmNyZWF0ZShpZnJhbWVCb3JkZXJzKSk7XG5cbiAgICAgICAgICAgIGlmIChpc0h0bWxFbGVtZW50KVxuICAgICAgICAgICAgICAgIGVsQm9yZGVycy5hZGQoaWZyYW1lQm9yZGVycyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBoYXNSaWdodFNjcm9sbGJhciAgPSAhaXNIdG1sRWxlbWVudCAmJiBhZGFwdGVyLnN0eWxlLmdldElubmVyV2lkdGgodGFyZ2V0KSAhPT0gdGFyZ2V0LmNsaWVudFdpZHRoO1xuICAgIGNvbnN0IGhhc0JvdHRvbVNjcm9sbGJhciA9ICFpc0h0bWxFbGVtZW50ICYmIGFkYXB0ZXIuc3R5bGUuZ2V0SW5uZXJIZWlnaHQodGFyZ2V0KSAhPT0gdGFyZ2V0LmNsaWVudEhlaWdodDtcblxuICAgIGNvbnN0IHNjcm9sbGJhciA9IHtcbiAgICAgICAgcmlnaHQ6ICBoYXNSaWdodFNjcm9sbGJhciA/IGFkYXB0ZXIuZG9tLmdldFNjcm9sbGJhclNpemUoKSA6IDAsXG4gICAgICAgIGJvdHRvbTogaGFzQm90dG9tU2Nyb2xsYmFyID8gYWRhcHRlci5kb20uZ2V0U2Nyb2xsYmFyU2l6ZSgpIDogMCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ldyBEaW1lbnNpb25zKGVsV2lkdGgsIGVsSGVpZ2h0LCBlbFBvc2l0aW9uLCBlbEJvcmRlcnMsIGVsU2Nyb2xsLCBzY3JvbGxiYXIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudEZyb21Qb2ludCAoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBFbGVtZW50IHwgbnVsbCB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbnN0IGllRm4gPSBkb2N1bWVudC5nZXRFbGVtZW50RnJvbVBvaW50O1xuICAgIGNvbnN0IGZ1bmMgPSBpZUZuIHx8IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQ7XG5cbiAgICBsZXQgZWw6IEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuICAgIHRyeSB7XG4gICAgICAgIC8vIFBlcm1pc3Npb24gZGVuaWVkIHRvIGFjY2VzcyBwcm9wZXJ0eSAnZ2V0RWxlbWVudEZyb21Qb2ludCcgZXJyb3IgaW4gaWZyYW1lXG4gICAgICAgIGVsID0gZnVuYy5jYWxsKGRvY3VtZW50LCB4LCB5KTtcbiAgICB9XG4gICAgY2F0Y2gge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvL05PVEU6IGVsZW1lbnRGcm9tUG9pbnQgcmV0dXJucyBudWxsIHdoZW4gaXMncyBhIGJvcmRlciBvZiBhbiBpZnJhbWVcbiAgICBpZiAoZWwgPT09IG51bGwpXG4gICAgICAgIGVsID0gZnVuYy5jYWxsKGRvY3VtZW50LCB4IC0gMSwgeSAtIDEpO1xuXG4gICAgd2hpbGUgKGVsICYmIGVsLnNoYWRvd1Jvb3QgJiYgZWwuc2hhZG93Um9vdC5lbGVtZW50RnJvbVBvaW50KSB7XG4gICAgICAgIGNvbnN0IHNoYWRvd0VsID0gZWwuc2hhZG93Um9vdC5lbGVtZW50RnJvbVBvaW50KHgsIHkpO1xuXG4gICAgICAgIGlmICghc2hhZG93RWwgfHwgZWwgPT09IHNoYWRvd0VsKVxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZWwgPSBzaGFkb3dFbDtcbiAgICB9XG5cbiAgICByZXR1cm4gZWw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjUmVsYXRpdmVQb3NpdGlvbiAoZGltZW5zaW9uczogRGltZW5zaW9ucywgdG9EaW1lbnNpb25zOiBEaW1lbnNpb25zKTogQm91bmRhcnlWYWx1ZXNEYXRhIHtcbiAgICBjb25zdCBwb3MgPSBCb3VuZGFyeVZhbHVlcy5jcmVhdGUoe1xuICAgICAgICB0b3A6ICAgIGRpbWVuc2lvbnMudG9wIC0gdG9EaW1lbnNpb25zLnRvcCxcbiAgICAgICAgbGVmdDogICBkaW1lbnNpb25zLmxlZnQgLSB0b0RpbWVuc2lvbnMubGVmdCxcbiAgICAgICAgcmlnaHQ6ICB0b0RpbWVuc2lvbnMucmlnaHQgLSBkaW1lbnNpb25zLnJpZ2h0LFxuICAgICAgICBib3R0b206IHRvRGltZW5zaW9ucy5ib3R0b20gLSBkaW1lbnNpb25zLmJvdHRvbSxcbiAgICB9KTtcblxuICAgIHJldHVybiBwb3Muc3ViKHRvRGltZW5zaW9ucy5ib3JkZXIpLnN1Yih0b0RpbWVuc2lvbnMuc2Nyb2xsYmFyKS5yb3VuZChNYXRoLmNlaWwsIE1hdGguZmxvb3IpO1xufVxuIl19